<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://yoursite.com">
  <title>windse7en</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="windse7en">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="windse7en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="windse7en">
  
    <link rel="alternative" href="/atom.xml" title="windse7en" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" type="text/css" href="/./main.2d7529.css">
  <style type="text/css">
  
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  

  

</head>

<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      
<div class="overlay" style="background: #4d4d4d"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="null" class="js-avatar">
		</a>
		<hgroup>
		  <h1 class="header-author"><a href="/">Tao Zhang</a></h1>
		</hgroup>
		
		<p class="header-subtitle">while(1){slef++;}</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/tags/随笔/">随笔</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
    		
    			
    			<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">所有文章</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'friends')" href="javascript:void(0)">友链</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">关于我</a>
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="#" title="github"><i class="icon-github"></i></a>
		        
					<a class="weibo" target="_blank" href="#" title="weibo"><i class="icon-weibo"></i></a>
		        
					<a class="rss" target="_blank" href="#" title="rss"><i class="icon-rss"></i></a>
		        
					<a class="zhihu" target="_blank" href="#" title="zhihu"><i class="icon-zhihu"></i></a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #4d4d4d"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="null" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author">Tao Zhang</h1>
			</hgroup>
			
			<p class="header-subtitle"><i class="icon icon-quo-left"></i>while(1){slef++;}<i class="icon icon-quo-right"></i></p>
			
			
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="#" title="github"><i class="icon-github"></i></a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo"><i class="icon-weibo"></i></a>
			        
						<a class="rss" target="_blank" href="#" title="rss"><i class="icon-rss"></i></a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu"><i class="icon-zhihu"></i></a>
			        
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 50%">
				
				
					<li style="width: 50%"><a href="/">主页</a></li>
		        
					<li style="width: 50%"><a href="/tags/随笔/">随笔</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1" class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            
  
    <article id="post-Migration-from-octopress-to-hexo" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/26/Migration-from-octopress-to-hexo/">Migration from octopress to hexo</a>
    </h1>
  

        
        <a href="/2017/02/26/Migration-from-octopress-to-hexo/" class="archive-article-date">
  	<time datetime="2017-02-26T17:58:03.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-02-26</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="记录从Octopress迁移到hexo"><a href="#记录从Octopress迁移到hexo" class="headerlink" title="记录从Octopress迁移到hexo"></a>记录从<a href="https://hexo.io/zh-tw/docs/migration.html" target="_blank" rel="external">Octopress迁移</a>到hexo</h1><h2 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h2><ol>
<li>安装<a href="https://hexo.io/zh-tw/docs/commands.html" target="_blank" rel="external">hexo</a>，新建一个project</li>
<li>pull <a href="https://github.com/litten/hexo-theme-yilia" target="_blank" rel="external">yilia project</a>，安装主题</li>
<li>把原来的post复制到hexo的<code>source/post</code>下面</li>
<li>原来的文章里面有两个}的情况，需要去掉</li>
</ol>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/02/26/Migration-from-octopress-to-hexo/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-hello-world" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/26/hello-world/">Hello World</a>
    </h1>
  

        
        <a href="/2017/02/26/hello-world/" class="archive-article-date">
  	<time datetime="2017-02-26T15:46:24.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-02-26</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/02/26/hello-world/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-l-chef-online-tutorial" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/31/l-chef-online-tutorial/">L: Chef online tutorial</a>
    </h1>
  

        
        <a href="/2015/07/31/l-chef-online-tutorial/" class="archive-article-date">
  	<time datetime="2015-07-31T15:13:48.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2015-07-31</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://learn.chef.io/" target="_blank" rel="external">Chef Online Tutorial</a></p>
<h1 id="1-Learn-the-Chef-basics-Ubuntu"><a href="#1-Learn-the-Chef-basics-Ubuntu" class="headerlink" title="1.    Learn the Chef basics - Ubuntu"></a>1.    Learn the Chef basics - Ubuntu</h1><p>Objectives:</p>
<ol>
<li>have a basic understanding of what happens when Chef runs.</li>
<li>be able to write Chef code that defines a basic policy.</li>
<li>be able to apply that policy to a server.</li>
</ol>
<h2 id="a-Get-set-up"><a href="#a-Get-set-up" class="headerlink" title="a.   Get set up"></a>a.   Get set up</h2><ol>
<li>Launch an Ubuntu virtual machine hosted by the chef.</li>
<li>use vim for text editor</li>
</ol>
<h2 id="b-Configure-a-resource"><a href="#b-Configure-a-resource" class="headerlink" title="b.   Configure a resource"></a>b.   <a href="https://learn.chef.io/learn-the-basics/ubuntu/configure-a-resource/" target="_blank" rel="external">Configure a resource</a></h2><table>
<thead>
<tr>
<th>Chef component</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>resource</td>
<td>describes some piece of infrastructure, such as a file, a template, or a package.</td>
</tr>
<tr>
<td>recipe</td>
<td>a file that groups related resources, such as everything needed to configure a web server, database server, or a load balancer.</td>
</tr>
<tr>
<td>cookbook</td>
<td>provides structure to your recipes and enables, such as our web server’s home page. In essence, a cookbook helps you stay organized.</td>
</tr>
<tr>
<td>knife</td>
<td>enables you to interact with the Chef server</td>
</tr>
<tr>
<td>node</td>
<td>all the computer resources infrastructure managed by Chef</td>
</tr>
</tbody>
</table>
<p><a href="http://docs.chef.io/resource_file.html" target="_blank" rel="external">file chef docs</a><br><a href="https://docs.chef.io/resource_directory.html" target="_blank" rel="external">directory chef docs</a></p>
<p>chef-repo save all the resources files<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chef-apply filename.rb  #run the rb file</div></pre></td></tr></table></figure></p>
<p>hello.rb is a recipe, motd file is the resource. Resource also can be package, service.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># Example for hello.rb</div><div class="line">file ‘motd’ do</div><div class="line">    action :create  # default action, if there isn’t explicit, it will called.</div><div class="line">    content ‘hello Tao’</div><div class="line">end</div></pre></td></tr></table></figure></p>
<p>The functionalities of recipe:</p>
<ol>
<li>install and configure software components.</li>
<li>manage files.</li>
<li>deploy applications.</li>
<li>execute other recipes.</li>
</ol>
<h2 id="c-Configure-a-package-and-service"><a href="#c-Configure-a-package-and-service" class="headerlink" title="c. Configure a package and service"></a>c. <a href="https://learn.chef.io/learn-the-basics/ubuntu/configure-a-package-and-service/" target="_blank" rel="external">Configure a package and service</a></h2><p>Install the Apache package</p>
<p>The order in the recipe is very important. But the orders of the attributes of the file is doesn’t matter.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"># webserver.rb configure the apache server</div><div class="line">execute ‘apt-get-update’ do</div><div class="line">  command ‘apt-get update’</div><div class="line">end </div><div class="line"></div><div class="line">package ‘apache2’</div><div class="line"></div><div class="line">service ‘apache2’ do</div><div class="line">  supports :status =&gt; true</div><div class="line">  action [:enable, :start]</div><div class="line">end</div><div class="line"></div><div class="line">file ‘/var/www/html/index.html’ do</div><div class="line">  content ‘&lt;html&gt;</div><div class="line">    &lt;body&gt;</div><div class="line">        &lt;h1&gt;hello Tao&lt;/h1&gt;</div><div class="line">          &lt;/body&gt;</div><div class="line">          &lt;/html&gt;’</div><div class="line">          end&lt;/h&gt;</div><div class="line">    &lt;/body&gt;</div><div class="line">  &lt;/html&gt;</div><div class="line">end </div></pre></td></tr></table></figure></p>
<h3 id="Verification"><a href="#Verification" class="headerlink" title="Verification"></a>Verification</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl localhost      # will see hell Tao</div></pre></td></tr></table></figure>
<h2 id="d-Make-your-recipe-more-manageable"><a href="#d-Make-your-recipe-more-manageable" class="headerlink" title="d.   Make your recipe more manageable"></a>d.   <a href="https://learn.chef.io/learn-the-basics/ubuntu/make-your-recipe-more-manageable/" target="_blank" rel="external">Make your recipe more manageable</a></h2><p>mkdir cookbooks,    use templates to handle html. chef-client to run the cookbooks with the recipe list.</p>
<h1 id="2-Learn-to-manage-Ubuntu-Node"><a href="#2-Learn-to-manage-Ubuntu-Node" class="headerlink" title="2.    Learn to manage Ubuntu Node"></a>2.    <a href="https://learn.chef.io/manage-a-node/ubuntu/" target="_blank" rel="external">Learn to manage Ubuntu Node</a></h1><p>objectives:</p>
<ol>
<li>be able to write Chef code to define a policy from your workstation.</li>
<li>be able to apply that policy to a node.</li>
<li>understand how to access cookbooks written by the Chef community.</li>
</ol>
<h2 id="a-Get-Set-up"><a href="#a-Get-Set-up" class="headerlink" title="a.   Get Set up"></a>a.   Get Set up</h2><p>configure the chef locally</p>
<h2 id="b-Set-up-your-Chef-server"><a href="#b-Set-up-your-Chef-server" class="headerlink" title="b.   Set up your Chef server"></a>b.   Set up your Chef server</h2><p>Download cookbook from the chef supermarkets<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">knife cookbook site download learn\_chef\_apache2</div><div class="line">knife cookbook upload learn\_chef\_apache2  #upload the cookbook</div></pre></td></tr></table></figure></p>
<h2 id="c-Bootstrap-your-node"><a href="#c-Bootstrap-your-node" class="headerlink" title="c. Bootstrap your node"></a>c. Bootstrap your node</h2><p>A very long command, don’t forget to apt-get update.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">knife node list</div><div class="line">knife node show node-name</div></pre></td></tr></table></figure>
<h2 id="d-Update-your-node’s-configuration"><a href="#d-Update-your-node’s-configuration" class="headerlink" title="d. Update your node’s configuration"></a>d. Update your node’s configuration</h2><p>You ran knife bootstrap to associate your node with the Chef server and do an initial check-in. Bootstrapping is a one-time process.<br>The knife ssh command enables you to update your node’s configuration when your cookbook changes.</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/chef/" class="article-tag-list-link color5">chef</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="/categories/tutorial/" class="article-tag-list-link color4">tutorial</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2015/07/31/l-chef-online-tutorial/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-t-chef-ruby" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/31/t-chef-ruby/">T: Chef Ruby</a>
    </h1>
  

        
        <a href="/2015/07/31/t-chef-ruby/" class="archive-article-date">
  	<time datetime="2015-07-31T13:39:50.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2015-07-31</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://docs.chef.io/client/_images/chef_overview.pl(" target="_blank" rel="external">chef component</a>ng)</p>
<p><a href="http://docs.chef.io/client/install_workstation.htmll" target="_blank" rel="external">介绍主页</a></p>
<p><a href="http://downloads.chef.io/chef-dk/ubuntu/#/" target="_blank" rel="external">下载ubuntu chef</a></p>
<h2 id="1-Install-chef-db"><a href="#1-Install-chef-db" class="headerlink" title="1.  Install chef-db"></a>1.  Install chef-db</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo dpkg -i chefdk\_0.6.2-1\_amd64.deb</div></pre></td></tr></table></figure>
<p>ChefDK contains:</p>
<ol>
<li>An early version of a brand new command-line tool, chef, that aims to streamline Chef workflow, starting with new generators.</li>
<li>The well-known cookbook dependency manager Berkshelf 3.0.</li>
<li>The Test Kitchen integration testing framework.</li>
<li>ChefSpec, which makes unit testing cookbooks a breeze.</li>
<li>Foodcritic, a linting tool for doing static code analysis on cookbooks.</li>
<li>All of the Chef tools you’re already familiar with: Chef Client, Knife, Ohai and Chef Zero.</li>
</ol>
<p>chefdb’s file structure after installation<br><img src="http://snag.gy/dEhVS.jpg"></p>
<h3 id="Verification"><a href="#Verification" class="headerlink" title="Verification"></a>Verification</h3><p>After installation, verify all the component:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chef verify</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>Componnet</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>berkshelf</td>
<td>管理cookbook</td>
</tr>
<tr>
<td>test-kitchen</td>
<td>测试cookbook框架</td>
</tr>
<tr>
<td>chef-client</td>
<td></td>
</tr>
<tr>
<td>chef-dk</td>
<td>Chef开发kit</td>
</tr>
<tr>
<td>chefspec</td>
<td></td>
</tr>
<tr>
<td>rubocop</td>
<td></td>
</tr>
<tr>
<td>fauxhai</td>
<td></td>
</tr>
<tr>
<td>knife-spork</td>
<td></td>
</tr>
<tr>
<td>kitchen-vagrant</td>
<td></td>
</tr>
<tr>
<td>package installation</td>
<td></td>
</tr>
<tr>
<td>openssl</td>
<td>安全机制SSL</td>
</tr>
</tbody>
</table>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p>安装结束,验证所有component安装成功.</p>
<h2 id="2-Install-and-configure-the-chef-server"><a href="#2-Install-and-configure-the-chef-server" class="headerlink" title="2.   Install and configure the chef-server"></a>2.   Install and configure the chef-server</h2><p>在chef主页注册hosted chef server, 之后下载starter kit<br><a href="https://manage.chef.io/organizations/tao_zhang/getting_started" target="_blank" rel="external">下载starter kit</a></p>
<p>Download start kit, chef-repo folder in the size of 9.5 KB</p>
<p><a href="http://snag.gy/Vo3ql.jpg" target="_blank" rel="external">locate the chef-repo</a><br>Contains chef configuration files.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">knife ssl fetch</div></pre></td></tr></table></figure>
<h3 id="Verification-1"><a href="#Verification-1" class="headerlink" title="Verification"></a>Verification</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">knife client -u windse7en -k ./.chef/windse7en.pem</div></pre></td></tr></table></figure>
<p>验证通过显示list</p>
<h3 id="Summary-1"><a href="#Summary-1" class="headerlink" title="Summary"></a>Summary</h3><p>配置好和server的connection结束</p>
<h2 id="3-Install-and-configure-a-node"><a href="#3-Install-and-configure-a-node" class="headerlink" title="3.   Install and configure a node"></a>3.   Install and configure a node</h2><p>在开启了SSH的情况下用knife配置node<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">knife bootstrap ip.address.. -x username -P password --sudo</div></pre></td></tr></table></figure></p>
<p><a href="http://snag.gy/CLuvy.jpg" target="_blank" rel="external">安装命令</a><br>deploy node divide into 4 steps:</p>
<ol>
<li>install the client(install chef-12.4.1-1.dmg above)</li>
<li>start chef client creating a new client identity</li>
<li>Synchronizing Cookbooks and Compile it</li>
<li>Run handlers</li>
</ol>
<h3 id="Verification-2"><a href="#Verification-2" class="headerlink" title="Verification"></a>Verification</h3><p>Pay attention to the current folder, as the knife will use the pem file for validation<br><img src="http://snag.gy/G56Jm.jpg"></p>
<p>The view after loginned the chef manager:<br><img src="http://snag.gy/PSDsf.jpg"></p>
<h3 id="Summary-2"><a href="#Summary-2" class="headerlink" title="Summary"></a>Summary</h3><p>Use the workstation or the server to monitor the node. I can’t find the chef-client in the node computer.</p>
<h2 id="4-Delete-the-node"><a href="#4-Delete-the-node" class="headerlink" title="4.   Delete the node"></a>4.   Delete the node</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">knife node delete node-name</div></pre></td></tr></table></figure>
<img src="http://snag.gy/8gwRD.jpg">
<p>After the delete, the client still can show the that node information.</p>
<h3 id="Verification-3"><a href="#Verification-3" class="headerlink" title="Verification"></a>Verification</h3><p>But there is no such node in the server.<br><img src="http://snag.gy/mryj6.jpg"></p>
<h3 id="Summary-3"><a href="#Summary-3" class="headerlink" title="Summary"></a>Summary</h3><p>It is quite easy to delte the node. But pay an attention to the info. The node information is node deleted completely from ther server.</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/chef/" class="article-tag-list-link color5">chef</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="/categories/ruby/" class="article-tag-list-link color5">ruby</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="/categories/infrastructure/" class="article-tag-list-link color5">infrastructure</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2015/07/31/t-chef-ruby/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-b-metaprogramming-ruby" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/27/b-metaprogramming-ruby/">B: Metaprogramming Ruby</a>
    </h1>
  

        
        <a href="/2015/07/27/b-metaprogramming-ruby/" class="archive-article-date">
  	<time datetime="2015-07-27T19:28:22.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2015-07-27</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>Metaprogramming is writing code that writes codes.</em></p>
<p>Get all mixed modules for an object:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(<span class="class"><span class="keyword">class</span> &lt;&lt; obj;</span> <span class="keyword">self</span>; <span class="keyword">end</span>).included_modules<span class="meta">&gt;&gt;</span>)</div></pre></td></tr></table></figure><br>在runtime下，取得obj的class，查找所有modules</p>
<p><em>Metaprogramming is writing code that manipulates language constructs at runtime.</em></p>
<h1 id="Chapter-1-Monday-The-object-model"><a href="#Chapter-1-Monday-The-object-model" class="headerlink" title="Chapter 1. Monday: The object model"></a>Chapter 1. Monday: The object model</h1><p>Classes themselves are nothing but objects.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">String.<span class="keyword">class</span>        <span class="comment"># =&gt; Class</span></div><div class="line">Class.superclass    <span class="comment"># =&gt; Module</span></div><div class="line">Module.superclass   <span class="comment"># =&gt; Object</span></div></pre></td></tr></table></figure>
<p>User namespace to avoid name clash, Modulename::Classname</p>
<p>obj.instance_variable_set(“@x”,10) 设定实例参数。</p>
<ol>
<li>It finds the method. This is a process called method lookup.</li>
<li>It executes the method. To do that, Ruby needs something called self.</li>
</ol>
<h3 id="Method-Lookup"><a href="#Method-Lookup" class="headerlink" title="Method Lookup"></a>Method Lookup</h3><p>the receiver and the ancestors chain. </p>
<h3 id="Kernel-Method"><a href="#Kernel-Method" class="headerlink" title="Kernel Method"></a>Kernel Method</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">quire ‘rubygems’</div><div class="line">gem ‘rails’ , ‘= <span class="number">2.3</span>.<span class="number">2</span>’</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">module</span> <span class="title">Kernel</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">gem</span><span class="params">(gem_name, \*version\_requirements)</span></span></div><div class="line">    <span class="comment"># ...</span></div></pre></td></tr></table></figure>
<p>“If you want to become a master of Ruby,” Bill warns you, “you should always know which object has the role self at any given moment.”</p>
<img src="http://snag.gy/8w3Cx.jpg">
<h1 id="Chapter-2-Tuesday-Methods"><a href="#Chapter-2-Tuesday-Methods" class="headerlink" title="Chapter 2. Tuesday: Methods"></a>Chapter 2. Tuesday: Methods</h1><h2 id="Dynamic-Methods"><a href="#Dynamic-Methods" class="headerlink" title="Dynamic Methods"></a>Dynamic Methods</h2><p>Where you learn how to call and define methods dynamically and remove the duplicated code.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj.send(<span class="symbol">:my</span>\_method, <span class="number">3</span>) <span class="comment"># =&gt; 6</span></div></pre></td></tr></table></figure>
<p>method_missing is Kernel#method_missing() responded to.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Table</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">method</span>\<span class="title">_missing</span><span class="params">(id,\*args,&amp;block)</span></span></div><div class="line">    <span class="keyword">return</span> as($1.to\_sym,\*args,&amp;block) <span class="keyword">if</span> id.to_s =~ <span class="regexp">/^to\_(.\*)/</span></div><div class="line">    <span class="keyword">return</span> rows\_with($1.to\_sym =&gt; args[<span class="number">0</span>]) <span class="keyword">if</span> id.to\_s =~ <span class="regexp">/^rows\_with\_(.\*)/</span></div><div class="line">    <span class="keyword">super</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="comment"># ...</span></div></pre></td></tr></table></figure>
<p>“string”.to_sym 生成对的symbol，用symbol调用方法。用super调用method_missing函数</p>
<h3 id="Dynamic-Proxy"><a href="#Dynamic-Proxy" class="headerlink" title="Dynamic Proxy"></a>Dynamic Proxy</h3><p>DelegateClass( ) is a Mimic Method (241) that creates and returns a new Class. This class defines a method_missing( ) that forwards calls to a wrapped object, such as an Assistant. Manager inherits this method_missing( ), so it becomes a proxy of the wrapped object.</p>
<p>用method_missing方法实现最好也实现respond_to这个method, const_missing可以把missed constant找到方法输出。</p>
<p>下面程序有个bug哦<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Roulette</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">method</span>\<span class="title">_missing</span><span class="params">(name, \*args)</span></span></div><div class="line">    person = name.to\_s.capitalize</div><div class="line">    <span class="number">3</span>.times <span class="keyword">do</span></div><div class="line">      number = rand(<span class="number">10</span>) + <span class="number">1</span></div><div class="line">      puts “<span class="comment">#&#123;number&#125;...”</span></div><div class="line">    <span class="keyword">end</span></div><div class="line">    “<span class="comment">#&#123;person&#125; got a #&#123;number&#125;”</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure><br>number 的scope</p>
<p>Ruby 里面用来去掉继承来的方法的method：<br>Module#undef_method    removes all methods, including the inherited ones.<br>Module#remove_method   removes the method from the receiver, but it leaves inherited methods alone.<br>The Builder library which is an XML generator 就是用了Blank Slate把object的class去掉了。</p>
<p>Ruby 怕方法被override，用reserved method name：__send__() and __id__()</p>
<p>Blank Slate 的样板code：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Computer</span></span></div><div class="line">  instance\_methods.each <span class="keyword">do</span> <span class="params">|m|</span></div><div class="line">    <span class="keyword">undef</span>\_method m unless m.to\_s =~ <span class="regexp">/^\_\_|method\_missing|respond\_to?/</span></div><div class="line">  <span class="keyword">end</span></div><div class="line">  <span class="comment"># ...</span></div></pre></td></tr></table></figure></p>
<h1 id="Chapter-3-Wednesday-Blocks"><a href="#Chapter-3-Wednesday-Blocks" class="headerlink" title="Chapter 3. Wednesday: Blocks"></a>Chapter 3. Wednesday: Blocks</h1><img src="http://snag.gy/oysCy.jpg">
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> <span class="keyword">yield</span> <span class="keyword">if</span> block\_given?</div></pre></td></tr></table></figure>
<p>Closure, the block is a closure. 看不到在my_method里面定义的variable x<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">def my\_method</div><div class="line">  x = “Goodbye</div><div class="line">  yield(“cruel”)</div><div class="line">end</div><div class="line"></div><div class="line">x=”Hello”</div><div class="line">my\_method &#123; |y| “#&#123;x&#125; #&#123;y&#125; world”&#125;      # =&gt; “Hello cruel world”</div></pre></td></tr></table></figure></p>
<p>use <em>local-variables</em> to track the local_variables </p>
<p><em>Whenever the program changes scope, some bindings are replaced by a new set of bindings.</em></p>
<p>Scope Gates keywords: class, module, def, end </p>
<h3 id="Beyond-the-Scope-Gates"><a href="#Beyond-the-Scope-Gates" class="headerlink" title="Beyond the Scope Gates"></a>Beyond the Scope Gates</h3><p>Q: Can you think of a method that does the same thing that class does?<br>A: If you look at Ruby’s documentation, you’ll find the answer: Class.new( ) is a perfect replacement for class. You can also define instance methods in the class if you pass a block to Class.new( ):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">my\_var = “Success”</div><div class="line">MyClass = Class.new do</div><div class="line">  # Now we can print my\_var here...</div><div class="line">  puts “#&#123;my\_var&#125; in the class definition!”</div><div class="line">  def my\_method</div><div class="line">  # ...but how can we print it here?</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<p>这个方法叫做nested lexical scopes，也叫做flattening the scope把两个scopes挤压到一起，简称Flat Scope.</p>
<p>Shared Scopes的例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">def define\_methods</div><div class="line">  shared = 0</div><div class="line">  Kernel.send :define\_method, :counter do</div><div class="line">    shared</div><div class="line">  end</div><div class="line">  Kernel.send :define\_method, :inc do |x|</div><div class="line">    shared += x</div><div class="line">  end</div><div class="line">end</div><div class="line"></div><div class="line">define\_methods</div><div class="line"></div><div class="line">counter # =&gt; 0</div><div class="line">inc(4)</div><div class="line">counter # =&gt; 4</div></pre></td></tr></table></figure></p>
<h3 id="instance-eval"><a href="#instance-eval" class="headerlink" title="instance_eval()"></a>instance_eval()</h3><p>用这个方法可以做Context Probe，把变量放入object中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">v = 2</div><div class="line">obj.instance\_eval &#123; @v = v &#125;</div><div class="line">obj.instance\_eval &#123; @v &#125; # =&gt; 2</div></pre></td></tr></table></figure></p>
<p>这是一种容易打破Encapsulation的方法，用在test中非常有效果</p>
<h3 id="Callable-Objects"><a href="#Callable-Objects" class="headerlink" title="Callable Objects"></a>Callable Objects</h3><p>Proc lambda 两个block object, method 也是一个call的objetct</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">inc = Proc.new &#123;|x| x + 1&#125;</div><div class="line">inc.call(2)</div><div class="line">dec = lambda &#123;|x| x - 1&#125;</div><div class="line">dec.class          # =&gt; Proc</div><div class="line">dec.call(2)        # =&gt; 1</div></pre></td></tr></table></figure>
<p>&amp;block_name 得到一个Proc对象。<br>Procs created with lambda( ) are called lambdas, while the others are simply called procs.</p>
<p>The differences between Proc and lambda:</p>
<ol>
<li>lambda中return返回相关值，Proc的return会直接退出所在的scope。为了避免这个情况，不用return只是写值</li>
<li>当arity，arg的参数数量不一定的时候，如果和block中不一样，lambda会报错，但是Proc会裁剪或者补充nil</li>
</ol>
<p>基于此，一般选择用lambda {} 更安全。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p = -&gt;(x) &#123; x + 1 &#125;         # 一种替代方法</div><div class="line">p = lambda &#123; |x| x + 1 &#125;</div></pre></td></tr></table></figure></p>
<img src="http://snag.gy/7xT16.jpg">
<p><em>P.121 最后讲的DSL非常清晰的讲了开发过程的几个阶段，多练练</em></p>
<h1 id="Chapter-4-Thursday-Class-Definitions"><a href="#Chapter-4-Thursday-Class-Definitions" class="headerlink" title="Chapter 4. Thursday: Class Definitions"></a>Chapter 4. Thursday: Class Definitions</h1><p>class_eval(), Module#class_eval(), add method to class</p>
<p>“I want to open this object, and I don’t particularly care it’s a class,” then instance_eval( ) is fine. If you’re thinking “I want an Open Class (31) here,” then class_eval( ) is almost certainly a better match.</p>
<p>Use instance variable to set the test data.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">class FakeTime</div><div class="line">  def self.now; ‘Mon Apr 06 12:15:50’ ; end</div><div class="line">end</div><div class="line"></div><div class="line">require ‘test/unit’</div><div class="line"></div><div class="line">class TestLoan &lt; Test::Unit::TestCase</div><div class="line">  def test_conversion_to_string</div><div class="line">    Loan.instance_eval &#123; @time_class = FakeTime &#125;</div><div class="line">    loan = Loan.new(‘War and Peace’ )</div><div class="line">    assert_equal ‘WAR AND PEACE loaned on Mon Apr 06 12:15:50’ , loan.to_s</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure></p>
<p>Singleton Methods in Actions:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">paragraph = “any string can be a paragraph”</div><div class="line">def paragraph.title?</div><div class="line">  self.upcase == self</div><div class="line">end</div><div class="line">index(paragraph)</div></pre></td></tr></table></figure><br>只给一个对象添加方法，同一类的不增加此方法。</p>
<h3 id="Class-Macros"><a href="#Class-Macros" class="headerlink" title="Class Macros:"></a>Class Macros:</h3><p>attr_accessor 就是一个Class Macros</p>
<img src="http://snag.gy/d4d7T.jpg">
<p>Ruby doesn’t always tell you the whole truth. Instead of the class that you see, an object can have its own special, hidden class. That’s called the eigenclass of the object<br>对象的固有方法。</p>
<p>增加类方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">class MyClass</div><div class="line">  def self.my\_method; end</div><div class="line">end</div><div class="line"></div><div class="line">def MyClass.my\_other\_method; end</div><div class="line"></div><div class="line"># eigenclass method</div><div class="line">class MyClass</div><div class="line">  class &lt;&lt; self</div><div class="line">    def my\_method; end</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure></p>
<p>Object#extend( ) is simply a shortcut that includes a module in the receiver’s eigenclass. You can always do that yourself, if you so choose.</p>
<h3 id="Aliases"><a href="#Aliases" class="headerlink" title="Aliases"></a>Aliases</h3><p>方法别名。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alias :new\_name :old\_name  # alias is a keyword, not a method, that is why no comma.</div></pre></td></tr></table></figure></p>
<h1 id="Chapter-5-Friday-Code-That-Writes-Code"><a href="#Chapter-5-Friday-Code-That-Writes-Code" class="headerlink" title="Chapter 5. Friday: Code That Writes Code"></a>Chapter 5. Friday: Code That Writes Code</h1><p>facets is a large collection of useful Ruby snippets.<br>Kernel#eval, executes the code in the string and returns the result</p>
<p>here documents: &lt;&lt; END    END</p>
<p>def self.inherited(subclass) 等类被继承的时候会调用此方法。inherited() is a Hook Method, as we can use it to hook into a particular event.<br>Module#included() is another Hook Method<br>Module#extend_object() Module#method_added( ), method_removed( ), or method_undefined( )</p>
<p>Chapter 5重点看一下，这里面有很好的实现，特别重要！！！</p>
<h1 id="Chapter-6-Epilogue"><a href="#Chapter-6-Epilogue" class="headerlink" title="Chapter 6. Epilogue"></a>Chapter 6. Epilogue</h1><p>一个小故事</p>
<h1 id="Chapter-7-The-Design-of-Active-Record"><a href="#Chapter-7-The-Design-of-Active-Record" class="headerlink" title="Chapter 7. The Design of Active Record"></a>Chapter 7. The Design of Active Record</h1><p>Decoupling, Simplicity, No Duplication</p>
<h1 id="Chapter-8-Inside-ActiveRecord"><a href="#Chapter-8-Inside-ActiveRecord" class="headerlink" title="Chapter 8. Inside ActiveRecord"></a>Chapter 8. Inside ActiveRecord</h1><p>dynamic attributes and dynamic finders</p>
<p>Dynamic Attributes: ActiveRecord的源代码很好的解释了怎么用的，在2.3.2版本的ActiveRecord，active_methods.rb文件，里面关于method_missing and respond_to?的重定义，很好的解释了Ghost Method 的用法。</p>
<p>Dynamic Finders: ActiveRecord, base.rb 里面的method missing方法和respond to?方法</p>
<p>There are also techniques and tools that you can leverage to deal with that complexity and to avoid some common metaprogramming pitfalls. Some of these tools, such as unit tests and Monkeypatch guards</p>
<h1 id="Chapter-9-Metaprogramming-Safely"><a href="#Chapter-9-Metaprogramming-Safely" class="headerlink" title="Chapter 9. Metaprogramming Safely"></a>Chapter 9. Metaprogramming Safely</h1><ol>
<li>What’s the pitfall of Metapgrogramming?</li>
<li>How to do unit test?</li>
</ol>
<p>before_filter method is defined in the ActionPack2.3.2/action_controller/filers.rb<br>actionpack-2.3.2/test/controller/filters_test.rb test case for the filters.</p>
<p>Open Class, Monkeypatches is dangerous:</p>
<ol>
<li>is global.</li>
<li>invisible, hard to be viewed. (included as a module, can be seen by the ancestors)</li>
<li>override old method implicitly</li>
</ol>
<p>Rake use method_defined? to defend the Monkeypatch for override old method.</p>
<h1 id="Appendix-A"><a href="#Appendix-A" class="headerlink" title="Appendix A:"></a>Appendix A:</h1><p>Ruby idioms, Metaprogramming spells:</p>
<table>
<thead>
<tr>
<th>Spell</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Argument Arrays</td>
<td>一队列参数</td>
<td>method(*args)</td>
</tr>
<tr>
<td>Around Alias</td>
<td>方法别名</td>
<td>alias :old_reverse :reverse</td>
</tr>
<tr>
<td>Blank Slate</td>
<td>去掉方法定义</td>
<td>undef_method m</td>
</tr>
<tr>
<td>Class Extension Mixin</td>
<td>module中扩展Hook method</td>
<td>module M; extent ModuleName</td>
</tr>
<tr>
<td>Class Macro</td>
<td>类的方法调用Macro</td>
<td>attr_accessor :age</td>
</tr>
<tr>
<td>Clean Room</td>
<td>用一个对象作为环境评价一个block</td>
<td>CleanRoom.new.instance_eval { method }</td>
</tr>
<tr>
<td>Class Extension</td>
<td>混合方法进入eigenclass</td>
<td>class &lt;&lt; C; include M; end</td>
</tr>
<tr>
<td>Code Processor</td>
<td>运行文件里的命令</td>
<td>eval ‘file string’</td>
</tr>
<tr>
<td>Context Probe</td>
<td>用探针访问私有域</td>
<td>obj.instance_eval { @private_variable }</td>
</tr>
<tr>
<td>Deferred Evaluation</td>
<td>调用Proc对象</td>
<td>&block; block.call</td>
</tr>
<tr>
<td>Dynamic Dispatch</td>
<td>动态调用方法</td>
<td>obj.public_send(:method_name)</td>
</tr>
<tr>
<td>Dynamic Method</td>
<td>动态定义方法</td>
<td>define_method :my_method</td>
</tr>
<tr>
<td>Dynamic Proxy</td>
<td>将方法delegate到其他对象</td>
<td>@target.send(name, *args, &amp;block)</td>
</tr>
<tr>
<td>Flat Scope</td>
<td>用block来传值入object</td>
<td>obj.instance_eval { @attr = local_variable}</td>
</tr>
<tr>
<td>Ghost Method</td>
<td>用method_missing和respond_to</td>
<td>method_missing, respond_to</td>
</tr>
<tr>
<td>Hook Method</td>
<td>重写方法反应object model events</td>
<td>def self.inherited(subclass)</td>
</tr>
<tr>
<td>Kernel Method</td>
<td>类似全局函数了</td>
<td>module Kernel;def a_method</td>
</tr>
<tr>
<td>Lazy Instance Variable</td>
<td>直到用的时候才初始化</td>
<td>def attribute; @attribute II= ‘value’</td>
</tr>
<tr>
<td>Mimic Method</td>
<td>attribute=() 就是方法，但是用起来mimic</td>
<td>attr_reader, private</td>
</tr>
<tr>
<td>Monkeypatch</td>
<td>runtime改变class的features</td>
<td>class String; def reverse</td>
</tr>
<tr>
<td>Named Arguments</td>
<td>函数参数的命名</td>
<td>method(args_hash)</td>
</tr>
<tr>
<td>Namespace</td>
<td>避免命名冲突</td>
<td>MyNamespace::Array</td>
</tr>
<tr>
<td>Nil Guards</td>
<td>用来实例化避免nil</td>
<td>@aII= []</td>
</tr>
<tr>
<td>Object Extension</td>
<td>设定唯一方法放到object’s eigenclass中</td>
<td>class &lt;&lt; obj; include M ; end</td>
</tr>
<tr>
<td>Open Class</td>
<td>rutime修改class</td>
<td>class String; def reverse</td>
</tr>
<tr>
<td>Pattern Dispatch</td>
<td>根据名字调用方法</td>
<td>public_send</td>
</tr>
<tr>
<td>Sandbox</td>
<td>沙盒安全运行</td>
<td>proc { $SAFE = 2}.call</td>
</tr>
<tr>
<td>Scope Gate</td>
<td>作用域</td>
<td>class, module, def</td>
</tr>
<tr>
<td>Self Yield</td>
<td>把这个对象传给block</td>
<td>[‘a’,’b’].shift.tap {}.upcase</td>
</tr>
<tr>
<td>Shared Score</td>
<td>测试里面的初始化过程</td>
<td>lambda{ shared=10}.call</td>
</tr>
<tr>
<td>Singleton Method</td>
<td>给唯一对象的方法</td>
<td>class &lt;&lt; obj; def method;end; end</td>
</tr>
<tr>
<td>String of Code</td>
<td>命令放到字符串里</td>
<td>eval(‘1+1’)</td>
</tr>
<tr>
<td>Symbol#to_proc</td>
<td>直接传方法名，当block非常简单的时候</td>
<td>names.map(%:capitalize)</td>
</tr>
</tbody>
</table>
<p>tap 用来给block传自己的对象，debug 更容易<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">class Object</div><div class="line">  def tap</div><div class="line">    yield self</div><div class="line">    self</div><div class="line">  end </div><div class="line">end </div></pre></td></tr></table></figure></p>
<p>Symbol#to_proc<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">class Symbol</div><div class="line">  def to\_proc</div><div class="line">    Proc.new &#123;|x| x.send(self) &#125;</div><div class="line">  end</div><div class="line">end</div><div class="line"></div><div class="line">names.map(&amp;:capitalize.to\_proc) #直接调用Symbol#to\_proc</div><div class="line">names.map(&amp;:capitalize)  # 系统简化以后的效果</div></pre></td></tr></table></figure></p>
<p>lambda,proc 不同，主要是参数不同以后的反应，还有return效果，一般都用lambda。<br>Class.ancesters 类的ancestors来看都有哪些modules和class<br>Instance.methods来看都有哪些方法。<br>&amp;block, block.call() 还是不一样的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">class CArray &lt; Array</div><div class="line">  def c(&amp;block)</div><div class="line">    collect! &amp;block  # 等于把block的字符串都考过来collect! &#123; |e| e*2 &#125;</div><div class="line">  end</div><div class="line">end </div><div class="line"></div><div class="line">class CArray &lt; Array</div><div class="line">  def c</div><div class="line">    collect! yield  # it’s the same as the block.call</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure></p>
<p>在源码里面看实现<br><a href="https://www.ruby-lang.org/en/downloads/" target="_blank" rel="external">下载ruby源码</a></p>
<h1 id="Appendix-B-DSL"><a href="#Appendix-B-DSL" class="headerlink" title="Appendix B: DSL"></a>Appendix B: DSL</h1>
      

      
    </div>
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/ruby/" class="article-tag-list-link color5">ruby</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="/categories/metaprogramming/" class="article-tag-list-link color1">metaprogramming</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2015/07/27/b-metaprogramming-ruby/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-learn-linux-command-tips" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/22/learn-linux-command-tips/">Learn: linux command tips</a>
    </h1>
  

        
        <a href="/2015/07/22/learn-linux-command-tips/" class="archive-article-date">
  	<time datetime="2015-07-22T15:48:10.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2015-07-22</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="info"><a href="#info" class="headerlink" title="info"></a>info</h1><p>帮助的中级文档，可以入手学习Emacs。主要的操作</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>h, ?</td>
<td>help</td>
</tr>
<tr>
<td>n([),p(])</td>
<td>next node, previous node</td>
</tr>
<tr>
<td>m</td>
<td>go to node by name</td>
</tr>
<tr>
<td>l</td>
<td>last location</td>
</tr>
<tr>
<td>t</td>
<td>top of file</td>
</tr>
<tr>
<td>u</td>
<td>upper layer of nodes</td>
</tr>
</tbody>
</table>
<h1 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h1><p><a href="http://coolshell.cn/articles/9104.html" target="_blank" rel="external">Sed 详解</a><br>大神级的全能文件处理工具。</p>
<table>
<thead>
<tr>
<th>Sign</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>$</td>
<td>last line</td>
</tr>
<tr>
<td>=</td>
<td>算行数</td>
</tr>
<tr>
<td>3,\$</td>
<td>从3行到文件结尾</td>
</tr>
<tr>
<td>s///g</td>
<td>全文替换</td>
</tr>
<tr>
<td>s/(&lt;[^&gt;]*)/\1/g</td>
<td>group regex display</td>
</tr>
<tr>
<td>/fish/c cat</td>
<td>替换匹配行</td>
</tr>
<tr>
<td>/fish/d</td>
<td>delete the line</td>
</tr>
<tr>
<td>1p</td>
<td>print the line</td>
</tr>
<tr>
<td>N;s/\n/,/</td>
<td>N 把下一行内容也放入缓冲区匹配</td>
</tr>
<tr>
<td>1 a Test; 1 i Test</td>
<td>insert and append context</td>
</tr>
</tbody>
</table>
<p>pattern space是测试和输出的buffer，hold space是装要测试的下步数据的内容。</p>
<table>
<thead>
<tr>
<th>HoldSpace</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>g</td>
<td>hold space 放到pattern space，原有内容清除</td>
</tr>
<tr>
<td>G</td>
<td>append in pattern space\n</td>
</tr>
<tr>
<td>h</td>
<td>pattern space 放到hold space，原有内容清除</td>
</tr>
<tr>
<td>H</td>
<td>append in hold space\n</td>
</tr>
<tr>
<td>x</td>
<td>交换patern space和hold space</td>
</tr>
</tbody>
</table>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/linux/" class="article-tag-list-link color1">linux</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="/categories/command/" class="article-tag-list-link color3">command</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2015/07/22/learn-linux-command-tips/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-book-design-patterns-in-ruby" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/17/book-design-patterns-in-ruby/">B: Design Patterns in Ruby</a>
    </h1>
  

        
        <a href="/2015/07/17/book-design-patterns-in-ruby/" class="archive-article-date">
  	<time datetime="2015-07-17T19:08:30.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2015-07-17</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Design-Patterns-in-Ruby"><a href="#Design-Patterns-in-Ruby" class="headerlink" title="Design Patterns in Ruby"></a>Design Patterns in Ruby</h1><p>GoF(Gang of Four) book: <em>Design Patterns: Elements of Reusable Object-Oriented Software.</em></p>
<p>prefer composition to inheritancy. Internal Domain-Specific Language(DSL), metaprogramming, convention not configuration</p>
<p>怎么用？<br>How do you add features to your program without turning the whole thing into a huge, unmanageable mess? So far, you have seen how to split the internal workings of your objects up among a family of classes with the Template Method pattern and how to use the Strategy pattern to split off whole chunks of algorithms. You have also seen how to react to requests coming into your objects with the Command pattern and how to keep up with changes made to other objects with the Observer pattern. Composites and iterators each help in their own way in dealing with collections of objects.</p>
<p>14 Design Patterns:</p>
<ol>
<li>Template Method:      Every pattern has a problem that it is trying to solve. For example, perhaps your code always wants to do exactly the same thing, except at step 44. Sometimes step 44 wants to do this, and sometimes it wants to do that. Perhaps you need a Template Method.</li>
<li>Strategy object:      Maybe it is not step 44 that wants to vary but the whole algorithm. You have a well-defined job, something that needs to get done, but there are a lot of ways to do it. You might need to remove the outer covering from a feline creature, and there is more than one technique you might employ. You might want to wrap those techniques—those algorithms—in a Strategy object.</li>
<li>Observer Pattern:     What if you have a class A, which needs to know what is happening over there in class B? But you don’t want to couple the two classes together because you never know when class C (or even class D!) might come along. You might want to consider using the Observer pattern.</li>
<li>Composition Pattern:  Sometimes you need to treat a collection of objects just like a single object—I can delete or copy or move an individual file, but I can also delete or copy or move a whole directory of files. If you need to build a collection of objects that looks just like one of the individual objects, you probably need the Composite pattern.</li>
<li>Iterator Pattern:     Now suppose you are writing some code that hides a collection of objects, but you don’t want the collection hidden too well:                                                                                                                                                                                                                                                             You would like your client to be able to access the objects in your collection in sequence without knowing how or where you have stored those objects. You definitely need the Iterator pattern.</li>
<li>Command Pattern:      Sometimes we need to wrap instructions in a kind of a postcard:                                                                                                                                                                                                                                                                                                                          Dear database, when you get this, delete row number 7843. Postcards are hard to come by in code, but the Command pattern is tailor made for this situation.</li>
<li>Adapter:              What do you do when an object does what you need it to do, but its interface is wrong? Your interface mismatch might be very deep and complex, or it might be as simple as needing an object that can write but having an object that calls it save. The GoF would recommend an Adapter to you.</li>
<li>Proxy:                Maybe you have the right object, but it is over there, someplace else on the network, and you don’t want the client code to care about its location. Or perhaps you want to delay creating your object as long as possible, or control access to it. In this circumstance, you may need a Proxy.</li>
<li>Decorator:            Sometimes you need to add responsibilities to your objects on the fly, at runtime. If you have a need for objects that implement some core capabilities but must sometimes take on additional responsibilities, perhaps you need the Decorator pattern.</li>
<li>Singleton:            Perhaps you have an instance of a class, and it needs to be the only instance of that class—that is, the single instance that everybody uses. Sounds like you have a Singleton.</li>
<li>Factory Method:       Now suppose you are writing a base class, one that is meant to be extended. As you are happily coding away at your base class, you realize that it needs to produce a new object and only the subclass will know exactly which kind of object to produce. You may need a Factory Method here.</li>
<li>Abstract Factory:     How do you create families of compatible objects? Suppose you have a system that models various types of cars, but not all engines are compatible with all fuel or cooling systems. How do you ensure that you don’t end up with the automotive equivalent of Frankenstein’s monster? You might build a class devoted to creating all of those objects and call it an Abstract Factory.</li>
<li>Builder:              Perhaps you are building an object so complex that its construction requires a significant bit of code. Even worse, the process of construction needs to vary according to the circumstances. Perhaps you need the Builder pattern?</li>
<li>Interpreter:          Ever have the feeling that you are using the wrong programming language to solve your problem? As crazy as it sounds, perhaps you should stop trying to solve your problem directly and build an Interpreter for a language that solves your problem more easily.</li>
</ol>
<h1 id="Chapter-3-Verying-the-Algorithm-with-the-Template-Method"><a href="#Chapter-3-Verying-the-Algorithm-with-the-Template-Method" class="headerlink" title="Chapter 3. Verying the Algorithm with the Template Method"></a>Chapter 3. Verying the Algorithm with the Template Method</h1><p>Thought: Separate the things that stay the same.</p>
<p>Template Method Patterm Example, hook methods:<br><img src="http://snag.gy/vkB9S.jpg"></p>
<h2 id="Templates-in-the-Wild"><a href="#Templates-in-the-Wild" class="headerlink" title="Templates in the Wild"></a>Templates in the Wild</h2><p>WEBrick, 跑一个httpserver用到了Template，可以overrite run method。</p>
<h1 id="Chapter-4-Replacing-the-Algorithm-with-the-Strategy"><a href="#Chapter-4-Replacing-the-Algorithm-with-the-Strategy" class="headerlink" title="Chapter 4. Replacing the Algorithm with the Strategy"></a>Chapter 4. Replacing the Algorithm with the Strategy</h1><p>加入了Strategy对象来描述<br><img src="http://snag.gy/fkwNm.jpg"></p>
<p>Strategy 就指得是一些知道how to do something的executable code。就像Proc(&amp;proc_variable)<br>就像sort的使用就用的是Strategy Pattern，穿进去Proc知道怎么排序</p>
<p>Ruby rdoc 用的就是Strategy Pattern<br><img src="http://snag.gy/PXBE1.jpg"></p>
<h2 id="Strategy-in-the-Wild"><a href="#Strategy-in-the-Wild" class="headerlink" title="Strategy in the Wild"></a>Strategy in the Wild</h2><p>Ruby 中rdoc用Strategy Pattern来定义显示format</p>
<h1 id="Chapter-5-Keeping-up-with-the-Times-with-the-Observer"><a href="#Chapter-5-Keeping-up-with-the-Times-with-the-Observer" class="headerlink" title="Chapter 5. Keeping up with the Times with the Observer"></a>Chapter 5. Keeping up with the Times with the Observer</h1><p>Core Challenge: building a system that is highly integrated that a system where every part is aware of the sate of the whole.<br>P.104 Explain the observer module</p>
<img src="http://snag.gy/Qtwd2.jpg">
<h2 id="Observer-in-the-Wild"><a href="#Observer-in-the-Wild" class="headerlink" title="Observer in the Wild"></a>Observer in the Wild</h2><p>ActiveRecord::Observer中用Observer来观察database records，created，read，written and deleted。</p>
<h1 id="Chapter-6-Assembling-the-Whole-from-the-Parts-with-the-Composite"><a href="#Chapter-6-Assembling-the-Whole-from-the-Parts-with-the-Composite" class="headerlink" title="Chapter 6. Assembling the Whole from the Parts with the Composite"></a>Chapter 6. Assembling the Whole from the Parts with the Composite</h1><p>Core Challenge: build up bigger objects from small sub-objects, which might themseleve be made up of still smaller sub-sub-objects.</p>
<img src="http://snag.gy/ybQ34.jpg">
<h2 id="Sprucing-Up-the-Composite-with-Operators"><a href="#Sprucing-Up-the-Composite-with-Operators" class="headerlink" title="Sprucing Up the Composite with Operators"></a>Sprucing Up the Composite with Operators</h2><p>It turns out that we can get this done by simply renaming the add_sub_task method:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">composite = CompositeTask.new(‘example’)</div><div class="line">composite &lt;&lt; MixTask.new</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">&lt;&lt;</span><span class="params">(task)</span></span></div><div class="line">  @sub_tasks &lt;&lt; task</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">[]</span><span class="params">(index)</span></span></div><div class="line">  @sub_tasks[index]</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">[]=</span><span class="params">(index, new_value)</span></span></div><div class="line">  @sub_tasks[index] = new_value</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure></p>
<h2 id="An-Inconvenient-Difference"><a href="#An-Inconvenient-Difference" class="headerlink" title="An Inconvenient Difference"></a>An Inconvenient Difference</h2><p>How to handle the difference between the leaf and the composite:</p>
<ol>
<li>leaf和composite不一样，addChild，deleteChild这样的方法leaf没有</li>
<li>leaf也加入这两种方法，但是如果被调用了怎么响应是个问题，ignore，exception，还是怎么样？</li>
</ol>
<p>最容易犯的问题：<br>Mistake：容易把Composite当成one level deeper，但实际上，composite是multiple levels的。</p>
<h2 id="Composites-in-the-Wild"><a href="#Composites-in-the-Wild" class="headerlink" title="Composites in the Wild"></a>Composites in the Wild</h2><p>在Ruby中，GUI libraries就是基于Composite Pattern实现的。</p>
<h1 id="Chapter-7-Reaching-into-a-Collection-with-the-Iterator"><a href="#Chapter-7-Reaching-into-a-Collection-with-the-Iterator" class="headerlink" title="Chapter 7. Reaching into a Collection with the Iterator"></a>Chapter 7. Reaching into a Collection with the Iterator</h1><p>Core Challenge: allows an aggregate object to provide the outsite wolrd with a way to access its collection of subobjects.</p>
<h2 id="External-Iterators"><a href="#External-Iterators" class="headerlink" title="External Iterators"></a>External Iterators</h2><p>Java’s iterator is external iterator, ‘external’- a separate object from the aggregate</p>
<h2 id="Internal-Iterators"><a href="#Internal-Iterators" class="headerlink" title="Internal Iterators"></a>Internal Iterators</h2><p>Ruby’s iterator, inside the aggregate object, the code block-based iterators.</p>
<h2 id="The-Inimitable-Enumerable"><a href="#The-Inimitable-Enumerable" class="headerlink" title="The Inimitable Enumerable"></a>The Inimitable Enumerable</h2><p>要实现iterator在ruby中，一般就include Enumerable方法，有了，覆盖each和&lt;=&gt;方法。<br>包括方法：all?, any?, include? …</p>
<h2 id="Using-and-Abusing-the-Iterator-Pattern"><a href="#Using-and-Abusing-the-Iterator-Pattern" class="headerlink" title="Using and Abusing the Iterator Pattern"></a>Using and Abusing the Iterator Pattern</h2><p>Mistake: What happens if the aggregate object changes while you are iterating through it?</p>
<h2 id="Iterators-in-the-Wild"><a href="#Iterators-in-the-Wild" class="headerlink" title="Iterators in the Wild"></a>Iterators in the Wild</h2><p>Ruby的各种each method</p>
<p>IO object，File.open(), Pathname.new，都是很好的iterator</p>
<p>ObjectSpace module each_object 显示interpreter中的所有object。<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ObjectSpace.each_object &#123; <span class="params">|o|</span> puts “<span class="symbol">Object:</span> <span class="comment">#&#123;o&#125;” &#125;</span></div></pre></td></tr></table></figure></p>
<h1 id="Chapter-8-Getting-Things-Done-with-Commands"><a href="#Chapter-8-Getting-Things-Done-with-Commands" class="headerlink" title="Chapter 8. Getting Things Done with Commands"></a>Chapter 8. Getting Things Done with Commands</h1><p>Core Challenge: an instruction to do something, something specific when something happens.</p>
<img src="http://snag.gy/RNTAs.jpg">
<h2 id="Using-and-Abusing-the-Command-Pattern"><a href="#Using-and-Abusing-the-Command-Pattern" class="headerlink" title="Using and Abusing the Command Pattern"></a>Using and Abusing the Command Pattern</h2><p>The key thing about the Command pattern is that it separates the thought from the deed. When you use this pattern, you are no longer simply saying, “Do this”; instead, you are saying, “Remember how to do this,” and, sometime later, “Do that thing that I told you to remember.”<br>用的太频繁，本来很简单的内容用pattern去实现了。</p>
<h2 id="The-Command-Pattern-in-the-Wild"><a href="#The-Command-Pattern-in-the-Wild" class="headerlink" title="The Command Pattern in the Wild"></a>The Command Pattern in the Wild</h2><p>ActiveRecord Migrations, up, down, change, Madeleine</p>
<h1 id="Chapter-9-Filling-in-the-Gaps-with-the-Adapter"><a href="#Chapter-9-Filling-in-the-Gaps-with-the-Adapter" class="headerlink" title="Chapter 9. Filling in the Gaps with the Adapter"></a>Chapter 9. Filling in the Gaps with the Adapter</h1><p>Core Chanllenge: bridge the gap between mismatching software interfaces. Ruby 运行时修改类和对象来创建adapter。</p>
<p>Adapter就是用来帮你给你要用的和你有的interface搭桥的。<br><img src="http://snag.gy/uSoFP.jpg"></p>
<p>Ruby中可以对实例添加方法的实例：<br><img src="http://snag.gy/oCtix.jpg"></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">bto = BritishTextObject.new(‘hello’, <span class="number">50.8</span>, <span class="symbol">:blue</span>)</div><div class="line"><span class="class"><span class="keyword">class</span> &lt;&lt; bto</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">color</span></span></div><div class="line">    colour</div><div class="line">  <span class="keyword">end</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">text</span></span></div><div class="line">    string</div><div class="line">  <span class="keyword">end</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">size_inches</span></span></div><div class="line">    <span class="keyword">return</span> size_mm/<span class="number">25.4</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">bto</span>.<span class="title">color</span></span></div><div class="line">  colour</div><div class="line"><span class="keyword">end</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">bto</span>.<span class="title">text</span></span></div><div class="line">  string</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<h2 id="Using-and-Abusing-the-Adapter-Pattern"><a href="#Using-and-Abusing-the-Adapter-Pattern" class="headerlink" title="Using and Abusing the Adapter Pattern"></a>Using and Abusing the Adapter Pattern</h2><p>It’s hard to call a method client decided but you didn’t think you needed.我很奇怪这个问题在哪里。</p>
<h2 id="Adapters-in-the-Wild"><a href="#Adapters-in-the-Wild" class="headerlink" title="Adapters in the Wild"></a>Adapters in the Wild</h2><p>ActiveRecord, AbstractAdapter 用来解决数据库的adapter的问题。</p>
<h1 id="Chapter-10-Getting-in-Front-of-Your-Object-with-a-Proxy"><a href="#Chapter-10-Getting-in-Front-of-Your-Object-with-a-Proxy" class="headerlink" title="Chapter 10. Getting in Front of Your Object with a Proxy"></a>Chapter 10. Getting in Front of Your Object with a Proxy</h1><p>Core Chanllenge: controll access to an object or providing a location-independent way of getting at the object or delaying its creations.</p>
<img src="http://snag.gy/DvfH4.jpg">
<p>Protection proxy 可以把check安全性的和功能性的放到一个class里面，这样以后容易修改。</p>
<p>RPC system soap/wsdl get weather information.</p>
<h2 id="Message-passing"><a href="#Message-passing" class="headerlink" title="Message passing"></a>Message passing</h2><p>method_missing(:symbol__name, *args), 方法名和参数</p>
<h2 id="Using-and-Abusing-Proxies"><a href="#Using-and-Abusing-Proxies" class="headerlink" title="Using and Abusing Proxies"></a>Using and Abusing Proxies</h2><p>As method_missing is slow and obsure for the code.</p>
<h2 id="Proxies-in-the-Wild"><a href="#Proxies-in-the-Wild" class="headerlink" title="Proxies in the Wild"></a>Proxies in the Wild</h2><p>Ruby SOAP, Ruby package method<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">class MathService</div><div class="line">  def add(a, b)</div><div class="line">    return a + b</div><div class="line">  end</div><div class="line">end</div><div class="line"></div><div class="line">require ‘drb/drb’</div><div class="line"></div><div class="line">math_service=MathService.new</div><div class="line">DRb.start_service(“druby://localhost:3030”, math_service)</div><div class="line">DRb.thread.join</div></pre></td></tr></table></figure></p>
<p>client part:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">require ‘drb/drb’</div><div class="line">DRb.start_service</div><div class="line"></div><div class="line">math_service = DRbObject.new_with_uri(“druby://localhost:3030”)</div><div class="line"></div><div class="line">sum=math_service.add(2,2)</div></pre></td></tr></table></figure></p>
<h2 id="Wrapping-Up-Pattern"><a href="#Wrapping-Up-Pattern" class="headerlink" title="Wrapping Up Pattern"></a>Wrapping Up Pattern</h2><p>主要解决的三个问题：</p>
<ol>
<li>保护对象，授权通信  protection proxy</li>
<li>隐藏对象在其他地方  remote proxy</li>
<li>延迟创建复杂对象    virtual proxy</li>
</ol>
<h1 id="Chapter-11-Improving-your-objects-with-a-decorator"><a href="#Chapter-11-Improving-your-objects-with-a-decorator" class="headerlink" title="Chapter 11. Improving your objects with a decorator"></a>Chapter 11. Improving your objects with a decorator</h1><p>Core Chanllenge: add an enhancement to an existing object.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">writer = CheckSummingWriter.new(TimeStampingWriter.new(NumberingWriter.new(SimpleWriter.new(‘final.txt’))))</div><div class="line">writer.write_line(‘Hello out there’)</div></pre></td></tr></table></figure>
<img src="http://snag.gy/2fCuf.jpg">
<p>extend Forwardable module for delegating the methods(use extend to add class-level methods)<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">require</span> ‘forwardable’</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">WriterDecorator</span></span></div><div class="line">  extend Forwardable</div><div class="line">  def_delegators <span class="symbol">:</span>@real_writer, <span class="symbol">:write_line</span>, <span class="symbol">:rewind</span>, <span class="symbol">:pos</span>, <span class="symbol">:close</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(real_writer)</span></span></div><div class="line">    @real_writer = real_writer</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure></p>
<h2 id="Using-and-Abusing-the-Decorator-Pattern"><a href="#Using-and-Abusing-the-Decorator-Pattern" class="headerlink" title="Using and Abusing the Decorator Pattern"></a>Using and Abusing the Decorator Pattern</h2><ol>
<li>harder to debug, different decorator class,</li>
<li>multiplying the number of objects floating around in your program创建对象太多了。</li>
</ol>
<h2 id="Decorators-in-the-Wild"><a href="#Decorators-in-the-Wild" class="headerlink" title="Decorators in the Wild"></a>Decorators in the Wild</h2><p>ActiveRecord 中有个alias_method_chain, 可以改变老的方法的名字，和新的进行置换。<br>链式修改，在所有修改装饰之后才调用开始类的输出。</p>
<h1 id="Chapter-12-Making-sure-there-is-only-one-with-the-Singleton"><a href="#Chapter-12-Making-sure-there-is-only-one-with-the-Singleton" class="headerlink" title="Chapter 12. Making sure there is only one with the Singleton"></a>Chapter 12. Making sure there is only one with the Singleton</h1><p> Core Chanllenge: there are some things that are unique.</p>
<p> 实现Singleton的三种方法：</p>
<ol>
<li>include singleton module</li>
<li>Global variable and constant technique</li>
<li>class as singleton</li>
<li><p>Module as singleton</p>
<p>Singleton: 只有一个、全局可用的实例</p>
</li>
</ol>
<p>@@variable for the class cariable. Java中是static</p>
<p>def self.method for the class method.</p>
<p>Ruby里面Singleton的使用过程，include之后，直接用SimpleLogger.instance得到唯一值<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">require</span> ‘singleton’</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleLogger</span></span></div><div class="line">  <span class="keyword">include</span> Singleton</div><div class="line">  <span class="comment"># Lots of code deleted...</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure></p>
<h2 id="Using-and-Abusing-the-Singleton-Pattern"><a href="#Using-and-Abusing-the-Singleton-Pattern" class="headerlink" title="Using and Abusing the Singleton Pattern"></a>Using and Abusing the Singleton Pattern</h2><ol>
<li>How many of the singletons needed?</li>
<li>Singletons on a need-to-know basis</li>
<li>Cure the Testing Blues. As singleton called by multiple class, there will be a lot independence.</li>
</ol>
<h2 id="Singletons-in-the-Wild"><a href="#Singletons-in-the-Wild" class="headerlink" title="Singletons in the Wild"></a>Singletons in the Wild</h2><p>rake, Inflections(单复数的), are singletons </p>
<h1 id="Chapter-13-Picking-the-Right-Class-with-a-Factory"><a href="#Chapter-13-Picking-the-Right-Class-with-a-Factory" class="headerlink" title="Chapter 13. Picking the Right Class with a Factory"></a>Chapter 13. Picking the Right Class with a Factory</h1><p>Core Challenge: How to pick the right class for the circumstance?</p>
<img src="http://snag.gy/vuATB.jpg">
<p>It just likes the templete pattern, share a common type. Because they implement a common set of methods.</p>
<h2 id="Parameterize-Factory-Methods"><a href="#Parameterize-Factory-Methods" class="headerlink" title="Parameterize Factory Methods"></a>Parameterize Factory Methods</h2><p>Give many parameters to the factory methods, use case switch to define which class to call.</p>
<p>Pond Example:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pond</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(number_animals, animal_class, number_plants, plant_class)</span></span></div><div class="line">    @animal_class = animal_class</div><div class="line">    @plant_class = plant_class</div><div class="line">    @animals = []</div><div class="line">    number_animals.times <span class="keyword">do</span> <span class="params">|i|</span></div><div class="line">      animal = new_organism(<span class="symbol">:animal</span>, “Animal<span class="comment">#&#123;i&#125;”)</span></div><div class="line">      @animals &lt;&lt; animal</div><div class="line">    <span class="keyword">end</span></div><div class="line">    @plants = []</div><div class="line">    number_plants.times <span class="keyword">do</span> <span class="params">|i|</span></div><div class="line">      plant = new_organism(<span class="symbol">:plant</span>, “Plant<span class="comment">#&#123;i&#125;”)</span></div><div class="line">      @plants &lt;&lt; plant</div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">simulate_one_day</span></span></div><div class="line">    @plants.each &#123;<span class="params">|plant|</span> plant.grow&#125;</div><div class="line">    @animals.each &#123;<span class="params">|animal|</span> animal.speak&#125;</div><div class="line">    @animals.each &#123;<span class="params">|animal|</span> animal.eat&#125;</div><div class="line">    @animals.each &#123;<span class="params">|animal|</span> animal.sleep&#125;</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">new_organism</span><span class="params">(type, name)</span></span></div><div class="line">    <span class="keyword">if</span> type == <span class="symbol">:animal</span></div><div class="line">      @animal_class.new(name)</div><div class="line">    <span class="keyword">elsif</span> type == <span class="symbol">:plant</span></div><div class="line">      @plant_class.new(name)</div><div class="line">    <span class="keyword">else</span></div><div class="line">      raise “Unknown organism <span class="symbol">type:</span> <span class="comment">#&#123;type&#125;”</span></div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure></p>
<p>An object dedicated to creating a compatible set of objects is called an abstract factory.<br>一个用来创建一堆对象的对象:Abstract Factory</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PondOrganismFactory</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">new_animal</span><span class="params">(name)</span></span></div><div class="line">    Frog.new(name)</div><div class="line">  <span class="keyword">end</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">new_plant</span><span class="params">(name)</span></span></div><div class="line">    Algae.new(name)</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">JungleOrganismFactory</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">new_animal</span><span class="params">(name)</span></span></div><div class="line">    Tiger.new(name)</div><div class="line">  <span class="keyword">end</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">new_plant</span><span class="params">(name)</span></span></div><div class="line">    Tree.new(name)</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Habitat</span></span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(number_animals, number_plants, organism_factory)</span></span></div><div class="line">  @organism_factory = organism_factory</div><div class="line">  @animals = []</div><div class="line">  number_animals.times <span class="keyword">do</span> <span class="params">|i|</span></div><div class="line">    animal = @organism_factory.new_animal(“Animal<span class="comment">#&#123;i&#125;”)</span></div><div class="line">    @animals &lt;&lt; animal</div><div class="line">  <span class="keyword">end</span></div><div class="line">  @plants = []</div><div class="line">  number_plants.times <span class="keyword">do</span> <span class="params">|i|</span></div><div class="line">    plant = @organism_factory.new_plant(“Plant<span class="comment">#&#123;i&#125;”)</span></div><div class="line">    @plants &lt;&lt; plant</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<img src="http://snag.gy/BXYm8.jpg">
<p>In the same way that the Factory Method pattern is really the Template Method pattern applied to object creation, so the Abstract Factory pattern is simply the Strategy pattern applied to the same problem.</p>
<h2 id="Using-and-Abusing-the-Factory-Patterns"><a href="#Using-and-Abusing-the-Factory-Patterns" class="headerlink" title="Using and Abusing the Factory Patterns"></a>Using and Abusing the Factory Patterns</h2><p>Balance the cost of the additional.</p>
<h2 id="Factory-Patterns-in-the-Wild"><a href="#Factory-Patterns-in-the-Wild" class="headerlink" title="Factory Patterns in the Wild"></a>Factory Patterns in the Wild</h2><p>ActiveRecord::Base use Factory Pattern to map the database connection.</p>
<h1 id="Chapter-14-Easier-Object-Construction-with-the-Builder"><a href="#Chapter-14-Easier-Object-Construction-with-the-Builder" class="headerlink" title="Chapter 14. Easier Object Construction with the Builder"></a>Chapter 14. Easier Object Construction with the Builder</h1><p>Core Chanllenge: a pattern designed to help you configure those complex objects.</p>
<img src="http://snag.gy/qis6x.jpg">
<h2 id="Polymorphic-Builders"><a href="#Polymorphic-Builders" class="headerlink" title="Polymorphic Builders"></a>Polymorphic Builders</h2><p>Builder 更关注怎么configure object而不是pick right class。<br><img src="http://snag.gy/il4mO.jpg"></p>
<p>通过method_missing方法，支持，例如add_trubo_adn_dvd_and_harddisk这样的方法<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">method_missing</span><span class="params">(name, *args)</span></span></div><div class="line">  words = name.to_s.split(“<span class="number">_</span>”)</div><div class="line">  <span class="keyword">return</span> <span class="keyword">super</span>(name, *args) unless words.shift == ‘add’</div><div class="line">  words.each <span class="keyword">do</span> <span class="params">|word|</span></div><div class="line">    <span class="keyword">next</span> <span class="keyword">if</span> word == ‘<span class="keyword">and</span>’</div><div class="line">    add_cd <span class="keyword">if</span> word == ‘cd’</div><div class="line">    add_dvd <span class="keyword">if</span> word == ‘dvd’</div><div class="line">    add_hard_disk(<span class="number">100000</span>) <span class="keyword">if</span> word == ‘harddisk’</div><div class="line">    turbo <span class="keyword">if</span> word == ‘turbo’</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure></p>
<h2 id="Using-and-Abusing-the-Builder-Pattern"><a href="#Using-and-Abusing-the-Builder-Pattern" class="headerlink" title="Using and Abusing the Builder Pattern"></a>Using and Abusing the Builder Pattern</h2><p>不太复杂的事情结果用Builder造成complex。</p>
<h2 id="Builders-in-the-Wild"><a href="#Builders-in-the-Wild" class="headerlink" title="Builders in the Wild"></a>Builders in the Wild</h2><p>MailFactory in ruby, config the mail and send it.</p>
<h1 id="Chapter-15-Assembling-your-system-with-the-interpreter"><a href="#Chapter-15-Assembling-your-system-with-the-interpreter" class="headerlink" title="Chapter 15. Assembling your system with the interpreter"></a>Chapter 15. Assembling your system with the interpreter</h1><p>Core Chanllenge: need an interpreter for a domain problem.</p>
<p>What kind of problems are good candidates for the Interpreter pattern? As a general rule, problems well suited to the Interpreter pattern tend to be selfcontained, with crisp boundaries around them. For example, if you are writing code that searches for specific objects based on some specification, you might consider creating a query language.1 Conversely, if you are faced with the task of creating complex object configurations, you might think about building a configuration language. Another clue that your problem might be right for the Interpreter pattern is that you find yourself creating lots of discrete chunks of code, chunks that seem easy enough to write in themselves<br>什么问题需要Interpreter Pattern呢？</p>
<ol>
<li>当这个问题可以被更小的边界包含的时候，例如需要对特殊对象的查询，query language，需要复杂配置，configuration language。</li>
<li>另一个是，你发现有很多离散的可重复代码块。</li>
</ol>
<h2 id="Building-an-Interpreter"><a href="#Building-an-Interpreter" class="headerlink" title="Building an Interpreter"></a>Building an Interpreter</h2><img src="http://snag.gy/7jOFa.jpg">
<ol>
<li>AST: abstract syntax tree. </li>
</ol>
<p>If the language is fairly complex and neither XML nor YAML seems appropriate, using a parser generator Racc.</p>
<h2 id="Using-and-Abusing-the-interpreter-Pattern"><a href="#Using-and-Abusing-the-interpreter-Pattern" class="headerlink" title="Using and Abusing the interpreter Pattern"></a>Using and Abusing the interpreter Pattern</h2><ol>
<li>The complexity issure, how complex your language will be.</li>
<li>Program efficiency. good choice for 80% code that really is performance insensitive.</li>
</ol>
<h2 id="Interpreters-in-the-wild"><a href="#Interpreters-in-the-wild" class="headerlink" title="Interpreters in the wild"></a>Interpreters in the wild</h2><p>Regular Expression for string matching.</p>
<p>Runt: expressing things like date and time ranges and schedules.</p>
<h1 id="Chapter-16-Opening-Up-Your-System-with-Domain-Specific-Languages"><a href="#Chapter-16-Opening-Up-Your-System-with-Domain-Specific-Languages" class="headerlink" title="Chapter 16. Opening Up Your System with Domain-Specific Languages"></a>Chapter 16. Opening Up Your System with Domain-Specific Languages</h1><p>Core Chanllenge: provider the language that used by the users.</p>
<h2 id="Using-and-Abusing-the-DSL"><a href="#Using-and-Abusing-the-DSL" class="headerlink" title="Using and Abusing the DSL"></a>Using and Abusing the DSL</h2><ol>
<li>error message is unfriendly.</li>
<li>If security is an issue, stay away from internal DSLs.</li>
</ol>
<h2 id="Internal-DSLs-in-the-Wild"><a href="#Internal-DSLs-in-the-Wild" class="headerlink" title="Internal DSLs in the Wild"></a>Internal DSLs in the Wild</h2><p>rake, task based on tasks. </p>
<h1 id="Chapter-17-Creating-Custom-Objects-with-Meta-programming"><a href="#Chapter-17-Creating-Custom-Objects-with-Meta-programming" class="headerlink" title="Chapter 17. Creating Custom Objects with Meta-programming"></a>Chapter 17. Creating Custom Objects with Meta-programming</h1><p>Core Chanllenge: Change the functionality in the runtime.</p>
<p>Use extend for the object insludes some module.对象mix Module用extend，class包含module用include。</p>
<p>The subclasses of Base do not automatically inherit any Composite pattern behavior. Instead, they inherit the member_of and composite_of class method to add the composite methods to the subclass.</p>
<h2 id="Using-and-Abusing-Meta-programming"><a href="#Using-and-Abusing-Meta-programming" class="headerlink" title="Using and Abusing Meta-programming"></a>Using and Abusing Meta-programming</h2><p>Meta-programming: writing programs that augment or change themseleves as they run.<br>The key danger is the unexpected interaction between features.</p>
<h2 id="Meta-programming-in-the-Wild"><a href="#Meta-programming-in-the-Wild" class="headerlink" title="Meta-programming in the Wild"></a>Meta-programming in the Wild</h2><p>attr_reader, attr_writer, attr_accessor. The three are meta-programming. like:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Object</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">readable_attribute</span><span class="params">(name)</span></span></div><div class="line">    code = <span class="string">%Q&#123;</span></div><div class="line">      def <span class="subst">#&#123;name&#125;</span></div><div class="line">        @<span class="subst">#&#123;name&#125;</span></div><div class="line">      end</div><div class="line">    &#125;</div><div class="line">    class_eval(code)</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BankAccount</span></span></div><div class="line">  readable_attribute <span class="symbol">:balance</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(balance)</span></span></div><div class="line">    @balance = balance</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>Forwardable module to delegae the methods.</p>
<h1 id="Chapter-18-Convention-Over-Configuration"><a href="#Chapter-18-Convention-Over-Configuration" class="headerlink" title="Chapter 18. Convention Over Configuration"></a>Chapter 18. Convention Over Configuration</h1><p>Core Chanllenge: How to make software systems extensible via configuration.</p>
<ol>
<li>Convention focuses to making it wasy to add adapters.</li>
<li>Some constraints on the adapter.</li>
</ol>
<h2 id="Using-and-Abusing-the-Convention-Over-Configuration-Pattern"><a href="#Using-and-Abusing-the-Convention-Over-Configuration-Pattern" class="headerlink" title="Using and Abusing the Convention Over Configuration Pattern"></a>Using and Abusing the Convention Over Configuration Pattern</h2><ol>
<li>The convention might be incomplete.</li>
<li>hard to write and no documentation for the operational road map.</li>
</ol>
<h1 id="Chapter-19-Conclusion"><a href="#Chapter-19-Conclusion" class="headerlink" title="Chapter 19. Conclusion"></a>Chapter 19. Conclusion</h1>
      

      
    </div>
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/ruby/" class="article-tag-list-link color5">ruby</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="/categories/designpattern/" class="article-tag-list-link color5">design pattern</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2015/07/17/book-design-patterns-in-ruby/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-practical-obect-oriented-design-in-ruby" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/16/practical-obect-oriented-design-in-ruby/">Practical Obect Oriented Design in Ruby</a>
    </h1>
  

        
        <a href="/2015/07/16/practical-obect-oriented-design-in-ruby/" class="archive-article-date">
  	<time datetime="2015-07-16T15:54:10.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2015-07-16</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Practical-Object-Oriented-Design-in-Ruby"><a href="#Practical-Object-Oriented-Design-in-Ruby" class="headerlink" title="Practical Object-Oriented Design in Ruby"></a>Practical Object-Oriented Design in Ruby</h1><p>Responsibilities, dependencies, interfaces, ducks, inheritance, behavior sharing, composition, and testing</p>
<p>Persist. Practice. Experiment. Imagine. Do your best work, and all else will follow.</p>
<table>
<thead>
<tr>
<th>Question</th>
<th>Information</th>
</tr>
</thead>
<tbody>
<tr>
<td>Inject Dependency</td>
<td>为了single responsbility， 怎么做ID来减少依赖</td>
</tr>
<tr>
<td>Direct of Dependency</td>
<td>当不能见到dependency的时候依赖该怎么设计，改变可能性和类的耦合性</td>
</tr>
<tr>
<td>Interface Design</td>
<td>public的interface的设计过程，需要对messages的理解</td>
</tr>
<tr>
<td>Duck Type</td>
<td>选好duck type</td>
</tr>
<tr>
<td>Inheritance</td>
<td>继承要很好的Abstract和message的理解，继承实际上就是把父类message delegate到子类去</td>
</tr>
<tr>
<td>hook methods</td>
<td>解耦合的很好的办法,initialize()和post_initialize()的关系,post_initialize就是hook</td>
</tr>
<tr>
<td>Liskov Substitution Principle</td>
<td>父类能做的，子类都能做，一个role的内容，include的class都能做</td>
</tr>
</tbody>
</table>
<p>OOD problem:</p>
<ol>
<li>Without design pattern.</li>
<li>With a little knowledge of design pattern, overdesign. “ No, I can’t add that feature; it wasn’t designed to do that.”</li>
<li>Without the act of programming. Design pattern is relying on the feedback loop.</li>
</ol>
<p>SOLID:<br>Single Responsibility( Transparent, Reasonable, Usable and Exemplary), reuse and maintain.<br>If you rephrase every<br>one of its methods as a question, asking the question ought to make sense. For example,<br>“Please Mr. Gear, what is your ratio?” If the simplest description you can devise uses the<br>word “and,” the class likely has more than one responsibility. If it uses the word “or,”<br>then the class has more than one responsibility and they aren’t even very related.<br>OO designers use the word cohesion to describe this concept. When everything in a<br>37<br>class is related to its central purpose, the class is said to be highly cohesive or to have a<br>single responsibility.P.37</p>
<p>Do not feel compelled to make design decisions prematurely. What is the future cost of doing nothing today?” </p>
<p>Always wrap instance variables in accessor methods instead of directly referring to variables. In a method use variable instead of @variable. As in the future, variable may be overrided a new function.</p>
<p>P41</p>
<p>Struct as “a convenient way to bundle a number of attributes together, using accessor<br>methods, without having to write an explicit class.” This is exactly what wheelify<br>does; it creates little lightweight objects that respond to rim and tire.   </p>
<p>Separating iteration from the action that’s being performed on each element is a common case of multiple responsibility that is easy to recognize.</p>
<h1 id="Chapter-3-Managing-Dependencies"><a href="#Chapter-3-Managing-Dependencies" class="headerlink" title="Chapter 3. Managing Dependencies"></a>Chapter 3. Managing Dependencies</h1><p>An object has a dependency when it knows<br>• The name of another class. Gear expects a class named Wheel to exist.<br>• The name of a message that it intends to send to someone other than self.<br>Gear expects a Wheel instance to respond to diameter.<br>• The arguments that a message requires. Gear knows that Wheel.new requires<br>a rim and a tire.<br>• The order of those arguments. Gear knows the first argument to Wheel.new<br>should be rim, the second, tire.</p>
<p>One especially destructive kind of dependency occurs where an object knows another who knows another who knows something; that is, where many messages are chained together to reach behavior that lives in a distant object.</p>
<p>The code above exposes an unjustified attachment to static types. dependency injection P.54</p>
<p>Dependencies are foreign invaders that represent vulnerabilities, and they should be concise, explicit, and isolated.</p>
<p>This new method lazily creates a new instance of Wheel, using Ruby’s<br>||= operator. In this case, creation of a new instance of Wheel is deferred until gear_inches invokes the new wheel method. P.55</p>
<p>Remove Argument-Order Dependencies</p>
<p>When the code in line 11 changed to use a hash, it lost its ependency on argument order but it gained a dependency on the names of the keys in the argument hash. This change is healthy. The new dependency is more stable than the old, and thus this code faces less risk of being forced to change.</p>
<p>In the example below, line 3 uses fetch to set @chainring to the default, 40, only if the :chainring key is not in the args hash. Setting the defaults in this way means that callers can actually cause @chainring to get set to false or nil, something that is not possible when using the || technique. P.61 use merge to merge the array list.<br>3 ways:</p>
<ol>
<li>||</li>
<li>Hash.fetch</li>
<li>Hash.merge</li>
</ol>
<p>The above technique for substituting an options hash for a list of fixed-order arguments is perfect for cases where you are forced to depend on external interfaces that P.62 you cannot change.</p>
<h3 id="Reversing-Dependencies"><a href="#Reversing-Dependencies" class="headerlink" title="Reversing Dependencies"></a>Reversing Dependencies</h3><p>改变dependency的方向：<br>Page 62 give an example on dependencie directions.</p>
<h3 id="Choosing-Dependency-Directions"><a href="#Choosing-Dependency-Directions" class="headerlink" title="Choosing Dependency Directions"></a>Choosing Dependency Directions</h3><ol>
<li>Some classes are more likely than others to have changes in requirements.</li>
<li>Concrete classes are more likely to change than abstract classes.</li>
<li>Changing a class that has many dependents will result in widespread consequences</li>
</ol>
<table>
<thead>
<tr>
<th>Class Type</th>
<th>Likelihood of Change</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ruby base classes</td>
<td>not changed</td>
</tr>
<tr>
<td>framework classes</td>
<td>may rapid or none based on the development</td>
</tr>
<tr>
<td>Abstractions classes</td>
<td>less change</td>
</tr>
<tr>
<td>Concretion classes</td>
<td>more change</td>
</tr>
</tbody>
</table>
<p>In statically typed languages defining an interface is always intentional. But as Duck type, it’s just message in Ruby.</p>
<img src="http://snag.gy/z0WaJ.jpg" class="left">
<p>Zone A contain abstract classes or interfaces, suggested.<br>Zone C prefer the concrete classes, as few classes depend on them.<br>Zone B is fine always.<br>Zone D is Danger Zone, delete them.</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>Dependency management is core to creating future-proof applications. Injecting dependencies creates loosely coupled objects that can be reused in novel ways.<br>Isolating dependencies allows objects to quickly adapt to unexpected changes. Depending on abstractions decreases the likelihood of facing these changes.<br>The key to managing dependencies is to control their direction. The road to maintenance nirvana is paved with classes that depend on things that change less often than they do.</p>
<h1 id="Chapter-4-Creating-Flexible-Interfaces"><a href="#Chapter-4-Creating-Flexible-Interfaces" class="headerlink" title="Chapter 4. Creating Flexible Interfaces"></a>Chapter 4. Creating Flexible Interfaces</h1><p>The remainder of this chapter will address the first kind of interface, that is, methods within a class and how and what to expose to others.</p>
<p>Public:<br>• Reveal its primary responsibility<br>• Are expected to be invoked by others<br>• Will not change on a whim<br>• Are safe for others to depend on<br>• Are thoroughly documented in the tests</p>
<p>Private:<br>• Handle implementation details<br>• Are not expected to be sent by other objects<br>• Can change for any reason whatsoever<br>• Are unsafe for others to depend on<br>• May not even be referenced in the tests</p>
<p>Nouns is for domain objects.<br>Messages need to be considered much more.</p>
<p>Using sequence diagrams, from P. 72 it explains about the sequence diagrams design.</p>
<p>When the conversation between Trip and Mechanic switched from a how to a what, one side effect was that the size of the public interface in Mechanic was drastically reduced.<br>P.80 很好的解释了Trip的各种关系。Mechanic需要prepare_trip, prepare_bicycle接口，Trip需要bicycles接口</p>
<p>If objects were human and could describe their own relationships, in Figure 4.5 Trip would be telling Mechanic: “I know what I want and I know how you do it;” in Figure 4.6: “I know what I want and I know what you do” and in Figure 4.7: “I know what I want and I trust you to do your part.” This blind trust is a keystone of object-oriented design. It allows objects to collaborate without binding themselves to context and is necessary in any application that expects to grow and change.</p>
<h2 id="Law-of-Demeter"><a href="#Law-of-Demeter" class="headerlink" title="Law of Demeter"></a>Law of Demeter</h2><p>One common way to remove “train wrecks” from code is to use delegation to avoid the “dots.” In object-oriented terms, to delegate a message is to pass it on to another object, often via a wrapper method.</p>
<p>Focusing on messages reveals objects that might otherwise be overlooked. When messages are trusting and ask for what the sender wants instead of telling the receiver how to behave, objects naturally evolve public interfaces that are flexible and reusable in novel and unexpected ways.</p>
<h1 id="Chapter-5-Reducing-Costs-with-Duck-Typing"><a href="#Chapter-5-Reducing-Costs-with-Duck-Typing" class="headerlink" title="Chapter 5. Reducing Costs with Duck Typing"></a>Chapter 5. Reducing Costs with Duck Typing</h1><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Trip</span></span></div><div class="line">  <span class="keyword">attr_reader</span> <span class="symbol">:bicycles</span>, <span class="symbol">:customers</span>, <span class="symbol">:vehicle</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">prepare</span><span class="params">(preparers)</span></span></div><div class="line">    preparers.each &#123;<span class="params">|preparer|</span></div><div class="line">      <span class="keyword">case</span> preparer</div><div class="line">      <span class="keyword">when</span> Mechanic</div><div class="line">        preparer.prepare_bicycles(bicycles)</div><div class="line">      <span class="keyword">when</span> TripCoordinator</div><div class="line">        preparer.buy_food(customers)</div><div class="line">      <span class="keyword">when</span> Driver</div><div class="line">        preparer.gas_up(vehicle)</div><div class="line">        preparer.fill_water_tank(vehicle)</div><div class="line">      <span class="keyword">end</span></div><div class="line">    &#125;</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>这种设计会导致很多dependency，因为都要知道相应的class name。用duck type的新设计。<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Trip</span></span></div><div class="line">  <span class="keyword">attr_reader</span> <span class="symbol">:bicycles</span>, <span class="symbol">:customers</span>, <span class="symbol">:vehicle</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">prepare</span><span class="params">(preparers)</span></span></div><div class="line">    preparers.each &#123;<span class="params">|preparer|</span> preparer.prepare_trip(<span class="keyword">self</span>)&#125;</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mechanic</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">prepare_trip</span><span class="params">(trip)</span></span></div><div class="line">    trip.bicycles.each &#123;<span class="params">|bicycle|</span> prepare_bicycle(bicycle)&#125;</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure></p>
<p>There are a number of ways to achieve polymorphism; duck typing, as you have surely guessed, is one. Inheritance and behavior sharing (via Ruby modules) are others, but those are topics for the next chapters.</p>
<p>You can replace the following with ducks:<br>• Case statements that switch on class<br>• kind_of? and is_a?<br>• responds_to?</p>
<p>“I know who you are and because of that I know what you do.” This knowledge exposes a lack of trust in collaborating objects and acts as a millstone around your object’s neck. It introduces dependencies that make code difficult to change.</p>
<ol>
<li>Place trust in your ducks</li>
<li>Documenting Duck Type by test</li>
<li>Sharing code between ducks</li>
<li>Choosing your ducks wisely 选好duck type，有时候依赖的是stable的class，例如core class，就可以不考虑duck type 他</li>
</ol>
<h1 id="Chapter-6-Acquiring-Behavior-Through-inheritance"><a href="#Chapter-6-Acquiring-Behavior-Through-inheritance" class="headerlink" title="Chapter 6. Acquiring Behavior Through inheritance"></a>Chapter 6. Acquiring Behavior Through inheritance</h1><p>The idea of inheritance may seem complicated but as with all complexity, there’s a simplifying abstraction. Inheritance is, at its core, a mechanism for automatic message delegation.</p>
<p>继承也不是随便用的，Abstraction才是父类，Template Method Pattern也要用好，注意default value和抛出异常的情况。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bicycle</span></span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">spares</span></span></div><div class="line">    &#123; <span class="symbol">tire_size:</span> tire_size, <span class="symbol">chain:</span> chain&#125;.merge(local_spares)</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">local_spares</span></span></div><div class="line">    &#123;&#125;</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">RoadBike</span> &lt; Bicycle</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">local_spares</span></span></div><div class="line">    &#123;<span class="symbol">tape_color:</span> tape_color&#125;</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>这种方法decouple了subclass实现，同时也调用了父类的实现。<br>Well-designed inheritance hierarchies are easy to extend with new subclasses, even for programmers who know very little about the application. This ease of extension is inheritance’s greatest strength. When your problem is one of needing numerous specializations of a stable, common abstraction, inheritance can be an extremely lowcost solution.</p>
<h1 id="Chapter-7-Sharing-Role-Behavior-with-Modules"><a href="#Chapter-7-Sharing-Role-Behavior-with-Modules" class="headerlink" title="Chapter 7. Sharing Role Behavior with Modules"></a>Chapter 7. Sharing Role Behavior with Modules</h1><p>Modules is also a kind of implementation of inheritance.</p>
<p>This chapter explores an alternative that uses the techniques of inheritance to share a role. It begins with an example that uses a Ruby module to define a common role and then proceeds to give practical advice about how to write all inheritable code.</p>
<img src="http://snag.gy/NgGea.jpg">
<p>Schedule is a role, schedulable? is the message. It should be in the targets.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">module</span> <span class="title">Schedulable</span></span></div><div class="line">  <span class="keyword">attr_writer</span> <span class="symbol">:schedule</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">schedule</span></span></div><div class="line">    @schedule <span class="params">||</span>= <span class="symbol">:</span><span class="symbol">:Schedule</span>.new</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">schedulable?</span><span class="params">(start_date, end_date)</span></span></div><div class="line">    !scheduled?(start_date - lead_days, end_date)</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">scheduled?</span><span class="params">(start_date, end_date)</span></span></div><div class="line">    schedule.scheduled?(<span class="keyword">self</span>, start_date, end_date)</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># includers may override</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">lead_days</span></span></div><div class="line">    <span class="number">0</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>If a module sends a message it must provide an implementation, even if that implementation merely raises an error indicating that users of the module must implement the method.</p>
<p>This chapter has been careful to maintain a distinction between classical inheritance and sharing code via modules. This is-a versus behaves-like-a difference definitely matters, each choice has distinct consequences. However, the coding techniques for these two things are very similar and this similarity exists because both techniques rely on automatic message delegation.</p>
<img src="http://snag.gy/23FVA.jpg">
<p>Liskov Substitution Principle (LSP) When you honor the contract, you are following the Liskov Substitution Principle, which is named for its creator, Barbara Liskov, and supplies the “L” in the SOLID design principles.</p>
<p>Following this principle creates applications where a subclass can be used anywhere its superclass would do, and where objects that include modules can be trusted to interchangeably play the module’s role.</p>
<p>Try to shallow the inheritance, don’t make to deep. 否则hook methods会很难找，而且程序员比较熟悉top和bottom的class，对于中间的很不熟悉。<br><img src="http://snag.gy/kxeDN.jpg"></p>
<p>Modules, therefore, should use the template method pattern to invite those that include them to supply specializations, and should implement hook methods to avoid forcing includers to send super (and thus know the algorithm).</p>
<h1 id="Chapter-8-Combining-Objects-with-Composition"><a href="#Chapter-8-Combining-Objects-with-Composition" class="headerlink" title="Chapter 8. Combining Objects with Composition"></a>Chapter 8. Combining Objects with Composition</h1><p>Composition 关系图<br><img src="http://snag.gy/a1dyM.jpg"></p>
<p>Bicycle, parts, partsfactory, and part(open struct).</p>
<h2 id="Deciding-Between-Inheritance-and-Composition"><a href="#Deciding-Between-Inheritance-and-Composition" class="headerlink" title="Deciding Between Inheritance and Composition"></a>Deciding Between Inheritance and Composition</h2><p>Benefits of Inheritance<br>Cost of Inheritance</p>
<p>Benefits of Composition: composition results in applications built of simple, pluggable objects that are easy to extend and change.<br>Cost of Composition: not obvious of the combined operation.</p>
<table>
<thead>
<tr>
<th>Relationship</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Inheritance</td>
<td>is-a</td>
</tr>
<tr>
<td>module duck type</td>
<td>behave like a</td>
</tr>
<tr>
<td>Composition</td>
<td>has-a</td>
</tr>
</tbody>
</table>
<h1 id="Chapter-9-Designing-Cost-Effective-Tests"><a href="#Chapter-9-Designing-Cost-Effective-Tests" class="headerlink" title="Chapter 9. Designing Cost-Effective Tests"></a>Chapter 9. Designing Cost-Effective Tests</h1><p>Refactoring is the process of changing a software system in such a way that it does not alter the external behavior of the code yet improves the internal structure.</p>
<p>Finally, the art of writing changeable code requires the ability to write high-value tests. Tests give you confidence to refactor constantly. Efficient tests prove that altered code continues to behave correctly without raising overall costs.</p>
<img src="http://snag.gy/vCgRE.jpg">
<p>这里面有很好的关于wheel，gear的测试设计。单元测试，Mock, write the test module for sharing functionality.</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/ruby/" class="article-tag-list-link color5">ruby</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="/categories/ood/" class="article-tag-list-link color4">ood</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2015/07/16/practical-obect-oriented-design-in-ruby/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-a-endless-journey-to-learn-vim" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/10/a-endless-journey-to-learn-vim/">a endless journey to learn vim</a>
    </h1>
  

        
        <a href="/2015/07/10/a-endless-journey-to-learn-vim/" class="archive-article-date">
  	<time datetime="2015-07-10T14:12:52.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2015-07-10</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This description to the VIM journey is to descript my learning process of VIM:</p>
<p>#开始通过看thoughtbot的vim教学视频学习怎么配置好vim的工作环境，玩vim adventure。第一部基本学会的内容：</p>
<ol>
<li>motion在一个文件中</li>
<li>vim中的letter，word，sentence，paragraph的概念</li>
<li>配置vim config文件选择template，颜色</li>
<li>掌握常用的：command</li>
<li>三种mode熟练切换</li>
</ol>
<p>VIM keystrokes的评价体系：VImGolf按了几个键，Repitation容不容易repete,undo 时候是否和计划的一样, keep a lean undo/redo history<br>习惯用<esc>o来取代<cr>因为undo会根据最近的change。<br>用思想来切换mode，如果信息输入完了，应该习惯切回normal<br>vim的熟练过程开始是熟悉keystoke，之后要有逻辑，motion和change分开，可以repeat motion或者change，DRY。<br>VIM思想Pattern</cr></esc></p>
<table>
<thead>
<tr>
<th>VIM Pattern</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Dot Formula</td>
<td>One Keystroke to move, one keystroke to execute</td>
</tr>
<tr>
<td>Series or Parallel</td>
<td>例如可以22@q的方式去修改，亦可以VG:<code>&lt;,</code>&gt;normal @a的方式parallel修改</td>
</tr>
</tbody>
</table>
<p>##掌握不好的地方：</p>
<ol>
<li>Normal下操作的互动</li>
<li>Visual下的互动命令</li>
<li>:h 的使用不熟练，找不到想要的帮助内容</li>
<li>:set 的内容不了解具体效果 VIM mode   </li>
</ol>
<table>
<thead>
<tr>
<th>Mode</th>
<th>功能描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Normal</td>
<td>操作</td>
</tr>
<tr>
<td>Insert</td>
<td>write</td>
</tr>
<tr>
<td>Visual</td>
<td>choose</td>
</tr>
<tr>
<td>Insert Normal mode</td>
<td><c-o>+normal keystroke</c-o></td>
</tr>
<tr>
<td>Operator-pending mode</td>
<td>dw,between d and w can be customized</td>
</tr>
<tr>
<td>Replace</td>
<td>replace the char</td>
</tr>
<tr>
<td>Char[line,block]-wise Visual mode</td>
<td>v,V,<c-v> enter diff visula mode</c-v></td>
</tr>
</tbody>
</table>
<p>##开始容易掌握的操作：</p>
<ol>
<li>$,), g, G, iao, IOA, v, n, &lt;&gt;</li>
<li>d, y, c, u, C-r, x</li>
<li>hjkl, f, t</li>
</ol>
<p>##开始掌握不好的操作：</p>
<ol>
<li>normal Mode：=, `, q, ;, . , r</li>
<li>Ex Mode: Q, ebw, HL, {}, C-i, C-o illustion   </li>
</ol>
<table>
<thead>
<tr>
<th>keystroke</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>;</td>
<td>重复之前的f或者t motion操作</td>
</tr>
<tr>
<td>.</td>
<td>重复最近的change操作</td>
</tr>
<tr>
<td>&amp;</td>
<td>重复最近的:substitutecommand</td>
</tr>
<tr>
<td>,</td>
<td>reverse ; 的结果，但远程有点慢</td>
</tr>
<tr>
<td>?</td>
<td>for preview match</td>
</tr>
<tr>
<td>*</td>
<td>Search forward for cursor word</td>
</tr>
<tr>
<td>=</td>
<td>Autoindent</td>
</tr>
<tr>
<td>!</td>
<td>filer {motion} lines by external program</td>
</tr>
<tr>
<td><c-w></c-w></td>
<td>insert mode delete back one word</td>
</tr>
<tr>
<td><c-u></c-u></td>
<td>insert mode delete back to start of line</td>
</tr>
<tr>
<td><c-h></c-h></td>
<td>insert mode delete back one char</td>
</tr>
<tr>
<td><c-o></c-o></td>
<td>进入Insert-Normal mode</td>
</tr>
<tr>
<td><c-r>0</c-r></td>
<td>insert mode paste from yunk and keep in one undo</td>
</tr>
<tr>
<td>V: o</td>
<td>toggle the free end</td>
</tr>
<tr>
<td><c-v></c-v></td>
<td>进入Visual-Block mode 可以多行一起输入</td>
</tr>
<tr>
<td>“ayy; “ap</td>
<td>copy into the register a, put from register a</td>
</tr>
<tr>
<td>yy; “0p; :reg “0</td>
<td>yank always copy into reg 0</td>
</tr>
<tr>
<td>”_; “+; “*</td>
<td>black hole reg, system clipboard, selection reg</td>
</tr>
</tbody>
</table>
<p>#重要的Plugin：</p>
<p>Easymotion：很方便的motion的插件非常给力。</p>
<p><plug>(easymotion-sn),                      <leader>s,                                               t,  /,</leader></plug></p>
<p>NERDCommenter: 快速注释</p>
<p><leader>c,                                  [count]<leader>cc</leader></leader></p>
<p>Tabulize: 样式对齐<br>,                                           a:: 功能是:Tabulaize \:zs<cr> 以:后面的内容对齐</cr></p>
<p>ctags：右侧显示函数树</p>
<p><leader>b</leader></p>
<p>NERDTree: 左侧的文件夹结构树</p>
<p><c-e>: toggle nerdtree</c-e></p>
<p>#熟练地Ex Commands<br>| ExCommands               | 描述                                               |<br>| —                      | —                                                |<br>| :grep searchstring <em>     | 功能上就是$ grep -n searchstring </em>                 |<br>| :2,5p                    | print echo the lines from line 2 to 5              |<br>| :/<body>/+1,/</body>/-1d | delete body tag 之间的行                           |<br>| :join                    | join without motions                               |<br>| :%s/Practical/Pragmatic  | 全文替代% is the file                              |<br>| :normal {command}        | …                                                |<br>| :6t.                     | :[range]copy {address} duplicate one or more lines |<br>| :m                       | move lines                                         |<br>| :colorscheme <c-d>       | show all options for the command                   |<br>| :<c-r><c-w>              | get the current word under cursor                  |<br>| :2,$!sort -t’,’ -k2      | sort current file by second column                 |<br>| :reg                     | show all registers info                            |</c-w></c-r></c-d></p>
<table>
<thead>
<tr>
<th>Keystrokes</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>vit</td>
<td>功能上是选择html<tag></tag>之间的内容</td>
</tr>
<tr>
<td>ci(</td>
<td>功能上是去掉()之间的内容进入insert mode</td>
</tr>
<tr>
<td>&gt;G</td>
<td>indent从cursor到end of file的位置</td>
</tr>
<tr>
<td>@:</td>
<td>重复之前的Ex command</td>
</tr>
<tr>
<td>daw</td>
<td>delete a word, 可以从后到前的word去掉space</td>
</tr>
<tr>
<td>[v]as</td>
<td>in visual mode choose a sentence</td>
</tr>
<tr>
<td>gv</td>
<td>reselect the last visual selection</td>
</tr>
<tr>
<td>gj,gk,g0,g^,g$</td>
<td>move down and up by display lines</td>
</tr>
<tr>
<td>ge</td>
<td>backward to the end of word, reverse of e</td>
</tr>
</tbody>
</table>
<p>#VIM 启动命令<br>| Commands     | 描述                                                    |<br>| —          | —                                                     |<br>| vi -u NONE N | -u NONE 指定不用vim渲染，N：set nocompatable提供vim功能 |</p>
<p>#VIM Powerful Customize<br>| Customize | 描述                 |<br>| —       | —                  |<br>| omap-info | 可以修改motions的key |</p>
<p>#经典Examples：<br><img src="http://snag.gy/SZMqK.jpg"><br>关于Ex Command的图表<br><img src="http://snag.gy/5BNKB.jpg"><br>Text Objects Table<br><img src="http://snag.gy/kddH2.jpg"></p>
<p>#Tips<br>| Tips    | 描述                                                                   |<br>| –      | –                                                                     |<br>| qq,22@q | 因为q好按所以放到reg q中，因为2和@是一个键，所以重复多次的时候可以用22 |</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/vim/" class="article-tag-list-link color4">vim</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2015/07/10/a-endless-journey-to-learn-vim/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-rspec-for-test-in-ruby" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/02/rspec-for-test-in-ruby/">Rspec for Test in Ruby</a>
    </h1>
  

        
        <a href="/2015/07/02/rspec-for-test-in-ruby/" class="archive-article-date">
  	<time datetime="2015-07-02T15:15:13.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2015-07-02</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://docs.google.com/spreadsheets/d/1KGqJEmfUaLwrieckqc9x80sNLf0Qpq9I6Mpl9rv4LpY/edit#gid=1111651514" target="_blank" rel="external">Excel for summary of ruby test</a></p>
<ol>
<li>make sure install the rspec gem  </li>
<li>Use “rspec file_name.rb” to run the rspec test</li>
</ol>
<p>Tips:</p>
<ol>
<li>already use expect syntax to instead of the should syntax.</li>
</ol>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/rspec/" class="article-tag-list-link color1">rspec</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="/categories/test/" class="article-tag-list-link color5">test</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="/categories/ruby/" class="article-tag-list-link color5">ruby</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2015/07/02/rspec-for-test-in-ruby/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 Tao Zhang
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true,
		showTags: false
	}
</script>

<script>!function(t){function n(r){if(e[r])return e[r].exports;var o=e[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var e={};return n.m=t,n.c=e,n.p="./",n(0)}([function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,n){var e=/\/|index.html/g;return t.replace(e,"")===n.replace(e,"")}function i(){for(var t=document.querySelectorAll(".js-header-menu li a"),n=window.location.pathname,e=0,r=t.length;e<r;e++){var i=t[e];o(n,i.getAttribute("href"))&&(0,d.default)(i,"active")}}function u(t){for(var n=t.offsetLeft,e=t.offsetParent;null!==e;)n+=e.offsetLeft,e=e.offsetParent;return n}function f(t){for(var n=t.offsetTop,e=t.offsetParent;null!==e;)n+=e.offsetTop,e=e.offsetParent;return n}function c(t,n,e,r,o){var i=u(t),c=f(t)-n;if(c-e<=o){var a=t.$newDom;a||(a=t.cloneNode(!0),(0,h.default)(t,a),t.$newDom=a,a.style.position="fixed",a.style.top=(e||c)+"px",a.style.left=i+"px",a.style.zIndex=r||2,a.style.width="100%",a.style.color="#fff"),a.style.visibility="visible",t.style.visibility="hidden"}else{t.style.visibility="visible";var s=t.$newDom;s&&(s.style.visibility="hidden")}}function a(){var t=document.querySelector(".js-overlay"),n=document.querySelector(".js-header-menu");c(t,document.body.scrollTop,-63,2,0),c(n,document.body.scrollTop,1,3,0)}function s(){document.querySelector("#container").addEventListener("scroll",function(t){a()}),window.addEventListener("scroll",function(t){a()}),a()}function l(){x.default.versions.mobile&&window.screen.width<800&&(i(),s())}var p=e(71),d=r(p),v=e(72),y=(r(v),e(84)),h=r(y),b=e(69),x=r(b),m=e(75),g=r(m),w=e(70);l(),(0,w.addLoadEvent)(function(){g.default.init()}),t.exports={}},function(t,n){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)},function(t,n){var e={}.hasOwnProperty;t.exports=function(t,n){return e.call(t,n)}},function(t,n,e){var r=e(49),o=e(15);t.exports=function(t){return r(o(t))}},function(t,n,e){t.exports=!e(8)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,e){var r=e(6),o=e(12);t.exports=e(4)?function(t,n,e){return r.f(t,n,o(1,e))}:function(t,n,e){return t[n]=e,t}},function(t,n,e){var r=e(10),o=e(30),i=e(24),u=Object.defineProperty;n.f=e(4)?Object.defineProperty:function(t,n,e){if(r(t),n=i(n,!0),r(e),o)try{return u(t,n,e)}catch(t){}if("get"in e||"set"in e)throw TypeError("Accessors not supported!");return"value"in e&&(t[n]=e.value),t}},function(t,n,e){var r=e(22)("wks"),o=e(13),i=e(1).Symbol,u="function"==typeof i,f=t.exports=function(t){return r[t]||(r[t]=u&&i[t]||(u?i:o)("Symbol."+t))};f.store=r},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n,e){var r=e(35),o=e(16);t.exports=Object.keys||function(t){return r(t,o)}},function(t,n,e){var r=e(11);t.exports=function(t){if(!r(t))throw TypeError(t+" is not an object!");return t}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var e=0,r=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++e+r).toString(36))}},function(t,n){var e=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=e)},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n){t.exports={}},function(t,n){t.exports=!0},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,e){var r=e(6).f,o=e(2),i=e(7)("toStringTag");t.exports=function(t,n,e){t&&!o(t=e?t:t.prototype,i)&&r(t,i,{configurable:!0,value:n})}},function(t,n,e){var r=e(22)("keys"),o=e(13);t.exports=function(t){return r[t]||(r[t]=o(t))}},function(t,n,e){var r=e(1),o="__core-js_shared__",i=r[o]||(r[o]={});t.exports=function(t){return i[t]||(i[t]={})}},function(t,n){var e=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:e)(t)}},function(t,n,e){var r=e(11);t.exports=function(t,n){if(!r(t))return t;var e,o;if(n&&"function"==typeof(e=t.toString)&&!r(o=e.call(t)))return o;if("function"==typeof(e=t.valueOf)&&!r(o=e.call(t)))return o;if(!n&&"function"==typeof(e=t.toString)&&!r(o=e.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},function(t,n,e){var r=e(1),o=e(14),i=e(18),u=e(26),f=e(6).f;t.exports=function(t){var n=o.Symbol||(o.Symbol=i?{}:r.Symbol||{});"_"==t.charAt(0)||t in n||f(n,t,{value:u.f(t)})}},function(t,n,e){n.f=e(7)},function(t,n,e){var r=e(1),o=e(14),i=e(46),u=e(5),f="prototype",c=function(t,n,e){var a,s,l,p=t&c.F,d=t&c.G,v=t&c.S,y=t&c.P,h=t&c.B,b=t&c.W,x=d?o:o[n]||(o[n]={}),m=x[f],g=d?r:v?r[n]:(r[n]||{})[f];d&&(e=n);for(a in e)s=!p&&g&&void 0!==g[a],s&&a in x||(l=s?g[a]:e[a],x[a]=d&&"function"!=typeof g[a]?e[a]:h&&s?i(l,r):b&&g[a]==l?function(t){var n=function(n,e,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,e)}return new t(n,e,r)}return t.apply(this,arguments)};return n[f]=t[f],n}(l):y&&"function"==typeof l?i(Function.call,l):l,y&&((x.virtual||(x.virtual={}))[a]=l,t&c.R&&m&&!m[a]&&u(m,a,l)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,t.exports=c},function(t,n){var e={}.toString;t.exports=function(t){return e.call(t).slice(8,-1)}},function(t,n,e){var r=e(11),o=e(1).document,i=r(o)&&r(o.createElement);t.exports=function(t){return i?o.createElement(t):{}}},function(t,n,e){t.exports=!e(4)&&!e(8)(function(){return 7!=Object.defineProperty(e(29)("div"),"a",{get:function(){return 7}}).a})},function(t,n,e){"use strict";var r=e(18),o=e(27),i=e(36),u=e(5),f=e(2),c=e(17),a=e(51),s=e(20),l=e(58),p=e(7)("iterator"),d=!([].keys&&"next"in[].keys()),v="@@iterator",y="keys",h="values",b=function(){return this};t.exports=function(t,n,e,x,m,g,w){a(e,n,x);var O,S,_,j=function(t){if(!d&&t in A)return A[t];switch(t){case y:return function(){return new e(this,t)};case h:return function(){return new e(this,t)}}return function(){return new e(this,t)}},P=n+" Iterator",E=m==h,M=!1,A=t.prototype,T=A[p]||A[v]||m&&A[m],L=T||j(m),N=m?E?j("entries"):L:void 0,C="Array"==n?A.entries||T:T;if(C&&(_=l(C.call(new t)),_!==Object.prototype&&(s(_,P,!0),r||f(_,p)||u(_,p,b))),E&&T&&T.name!==h&&(M=!0,L=function(){return T.call(this)}),r&&!w||!d&&!M&&A[p]||u(A,p,L),c[n]=L,c[P]=b,m)if(O={values:E?L:j(h),keys:g?L:j(y),entries:N},w)for(S in O)S in A||i(A,S,O[S]);else o(o.P+o.F*(d||M),n,O);return O}},function(t,n,e){var r=e(10),o=e(55),i=e(16),u=e(21)("IE_PROTO"),f=function(){},c="prototype",a=function(){var t,n=e(29)("iframe"),r=i.length,o="<",u=">";for(n.style.display="none",e(48).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write(o+"script"+u+"document.F=Object"+o+"/script"+u),t.close(),a=t.F;r--;)delete a[c][i[r]];return a()};t.exports=Object.create||function(t,n){var e;return null!==t?(f[c]=r(t),e=new f,f[c]=null,e[u]=t):e=a(),void 0===n?e:o(e,n)}},function(t,n,e){var r=e(35),o=e(16).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return r(t,o)}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,e){var r=e(2),o=e(3),i=e(45)(!1),u=e(21)("IE_PROTO");t.exports=function(t,n){var e,f=o(t),c=0,a=[];for(e in f)e!=u&&r(f,e)&&a.push(e);for(;n.length>c;)r(f,e=n[c++])&&(~i(a,e)||a.push(e));return a}},function(t,n,e){t.exports=e(5)},function(t,n,e){var r=e(15);t.exports=function(t){return Object(r(t))}},function(t,n,e){t.exports={default:e(41),__esModule:!0}},function(t,n,e){t.exports={default:e(42),__esModule:!0}},function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var o=e(39),i=r(o),u=e(38),f=r(u),c="function"==typeof f.default&&"symbol"==typeof i.default?function(t){return typeof t}:function(t){return t&&"function"==typeof f.default&&t.constructor===f.default&&t!==f.default.prototype?"symbol":typeof t};n.default="function"==typeof f.default&&"symbol"===c(i.default)?function(t){return"undefined"==typeof t?"undefined":c(t)}:function(t){return t&&"function"==typeof f.default&&t.constructor===f.default&&t!==f.default.prototype?"symbol":"undefined"==typeof t?"undefined":c(t)}},function(t,n,e){e(65),e(63),e(66),e(67),t.exports=e(14).Symbol},function(t,n,e){e(64),e(68),t.exports=e(26).f("iterator")},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n){t.exports=function(){}},function(t,n,e){var r=e(3),o=e(61),i=e(60);t.exports=function(t){return function(n,e,u){var f,c=r(n),a=o(c.length),s=i(u,a);if(t&&e!=e){for(;a>s;)if(f=c[s++],f!=f)return!0}else for(;a>s;s++)if((t||s in c)&&c[s]===e)return t||s||0;return!t&&-1}}},function(t,n,e){var r=e(43);t.exports=function(t,n,e){if(r(t),void 0===n)return t;switch(e){case 1:return function(e){return t.call(n,e)};case 2:return function(e,r){return t.call(n,e,r)};case 3:return function(e,r,o){return t.call(n,e,r,o)}}return function(){return t.apply(n,arguments)}}},function(t,n,e){var r=e(9),o=e(34),i=e(19);t.exports=function(t){var n=r(t),e=o.f;if(e)for(var u,f=e(t),c=i.f,a=0;f.length>a;)c.call(t,u=f[a++])&&n.push(u);return n}},function(t,n,e){t.exports=e(1).document&&document.documentElement},function(t,n,e){var r=e(28);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==r(t)?t.split(""):Object(t)}},function(t,n,e){var r=e(28);t.exports=Array.isArray||function(t){return"Array"==r(t)}},function(t,n,e){"use strict";var r=e(32),o=e(12),i=e(20),u={};e(5)(u,e(7)("iterator"),function(){return this}),t.exports=function(t,n,e){t.prototype=r(u,{next:o(1,e)}),i(t,n+" Iterator")}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,e){var r=e(9),o=e(3);t.exports=function(t,n){for(var e,i=o(t),u=r(i),f=u.length,c=0;f>c;)if(i[e=u[c++]]===n)return e}},function(t,n,e){var r=e(13)("meta"),o=e(11),i=e(2),u=e(6).f,f=0,c=Object.isExtensible||function(){return!0},a=!e(8)(function(){return c(Object.preventExtensions({}))}),s=function(t){u(t,r,{value:{i:"O"+ ++f,w:{}}})},l=function(t,n){if(!o(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!i(t,r)){if(!c(t))return"F";if(!n)return"E";s(t)}return t[r].i},p=function(t,n){if(!i(t,r)){if(!c(t))return!0;if(!n)return!1;s(t)}return t[r].w},d=function(t){return a&&v.NEED&&c(t)&&!i(t,r)&&s(t),t},v=t.exports={KEY:r,NEED:!1,fastKey:l,getWeak:p,onFreeze:d}},function(t,n,e){var r=e(6),o=e(10),i=e(9);t.exports=e(4)?Object.defineProperties:function(t,n){o(t);for(var e,u=i(n),f=u.length,c=0;f>c;)r.f(t,e=u[c++],n[e]);return t}},function(t,n,e){var r=e(19),o=e(12),i=e(3),u=e(24),f=e(2),c=e(30),a=Object.getOwnPropertyDescriptor;n.f=e(4)?a:function(t,n){if(t=i(t),n=u(n,!0),c)try{return a(t,n)}catch(t){}if(f(t,n))return o(!r.f.call(t,n),t[n])}},function(t,n,e){var r=e(3),o=e(33).f,i={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],f=function(t){try{return o(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==i.call(t)?f(t):o(r(t))}},function(t,n,e){var r=e(2),o=e(37),i=e(21)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=o(t),r(t,i)?t[i]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,e){var r=e(23),o=e(15);t.exports=function(t){return function(n,e){var i,u,f=String(o(n)),c=r(e),a=f.length;return c<0||c>=a?t?"":void 0:(i=f.charCodeAt(c),i<55296||i>56319||c+1===a||(u=f.charCodeAt(c+1))<56320||u>57343?t?f.charAt(c):i:t?f.slice(c,c+2):(i-55296<<10)+(u-56320)+65536)}}},function(t,n,e){var r=e(23),o=Math.max,i=Math.min;t.exports=function(t,n){return t=r(t),t<0?o(t+n,0):i(t,n)}},function(t,n,e){var r=e(23),o=Math.min;t.exports=function(t){return t>0?o(r(t),9007199254740991):0}},function(t,n,e){"use strict";var r=e(44),o=e(52),i=e(17),u=e(3);t.exports=e(31)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,e=this._i++;return!t||e>=t.length?(this._t=void 0,o(1)):"keys"==n?o(0,e):"values"==n?o(0,t[e]):o(0,[e,t[e]])},"values"),i.Arguments=i.Array,r("keys"),r("values"),r("entries")},function(t,n){},function(t,n,e){"use strict";var r=e(59)(!0);e(31)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,e=this._i;return e>=n.length?{value:void 0,done:!0}:(t=r(n,e),this._i+=t.length,{value:t,done:!1})})},function(t,n,e){"use strict";var r=e(1),o=e(2),i=e(4),u=e(27),f=e(36),c=e(54).KEY,a=e(8),s=e(22),l=e(20),p=e(13),d=e(7),v=e(26),y=e(25),h=e(53),b=e(47),x=e(50),m=e(10),g=e(3),w=e(24),O=e(12),S=e(32),_=e(57),j=e(56),P=e(6),E=e(9),M=j.f,A=P.f,T=_.f,L=r.Symbol,N=r.JSON,C=N&&N.stringify,k="prototype",F=d("_hidden"),q=d("toPrimitive"),I={}.propertyIsEnumerable,B=s("symbol-registry"),D=s("symbols"),W=s("op-symbols"),H=Object[k],K="function"==typeof L,R=r.QObject,J=!R||!R[k]||!R[k].findChild,U=i&&a(function(){return 7!=S(A({},"a",{get:function(){return A(this,"a",{value:7}).a}})).a})?function(t,n,e){var r=M(H,n);r&&delete H[n],A(t,n,e),r&&t!==H&&A(H,n,r)}:A,G=function(t){var n=D[t]=S(L[k]);return n._k=t,n},$=K&&"symbol"==typeof L.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof L},z=function(t,n,e){return t===H&&z(W,n,e),m(t),n=w(n,!0),m(e),o(D,n)?(e.enumerable?(o(t,F)&&t[F][n]&&(t[F][n]=!1),e=S(e,{enumerable:O(0,!1)})):(o(t,F)||A(t,F,O(1,{})),t[F][n]=!0),U(t,n,e)):A(t,n,e)},Y=function(t,n){m(t);for(var e,r=b(n=g(n)),o=0,i=r.length;i>o;)z(t,e=r[o++],n[e]);return t},Q=function(t,n){return void 0===n?S(t):Y(S(t),n)},X=function(t){var n=I.call(this,t=w(t,!0));return!(this===H&&o(D,t)&&!o(W,t))&&(!(n||!o(this,t)||!o(D,t)||o(this,F)&&this[F][t])||n)},V=function(t,n){if(t=g(t),n=w(n,!0),t!==H||!o(D,n)||o(W,n)){var e=M(t,n);return!e||!o(D,n)||o(t,F)&&t[F][n]||(e.enumerable=!0),e}},Z=function(t){for(var n,e=T(g(t)),r=[],i=0;e.length>i;)o(D,n=e[i++])||n==F||n==c||r.push(n);return r},tt=function(t){for(var n,e=t===H,r=T(e?W:g(t)),i=[],u=0;r.length>u;)!o(D,n=r[u++])||e&&!o(H,n)||i.push(D[n]);return i};K||(L=function(){if(this instanceof L)throw TypeError("Symbol is not a constructor!");var t=p(arguments.length>0?arguments[0]:void 0),n=function(e){this===H&&n.call(W,e),o(this,F)&&o(this[F],t)&&(this[F][t]=!1),U(this,t,O(1,e))};return i&&J&&U(H,t,{configurable:!0,set:n}),G(t)},f(L[k],"toString",function(){return this._k}),j.f=V,P.f=z,e(33).f=_.f=Z,e(19).f=X,e(34).f=tt,i&&!e(18)&&f(H,"propertyIsEnumerable",X,!0),v.f=function(t){return G(d(t))}),u(u.G+u.W+u.F*!K,{Symbol:L});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),et=0;nt.length>et;)d(nt[et++]);for(var nt=E(d.store),et=0;nt.length>et;)y(nt[et++]);u(u.S+u.F*!K,"Symbol",{for:function(t){return o(B,t+="")?B[t]:B[t]=L(t)},keyFor:function(t){if($(t))return h(B,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){J=!0},useSimple:function(){J=!1}}),u(u.S+u.F*!K,"Object",{create:Q,defineProperty:z,defineProperties:Y,getOwnPropertyDescriptor:V,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),N&&u(u.S+u.F*(!K||a(function(){var t=L();return"[null]"!=C([t])||"{}"!=C({a:t})||"{}"!=C(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!$(t)){for(var n,e,r=[t],o=1;arguments.length>o;)r.push(arguments[o++]);return n=r[1],"function"==typeof n&&(e=n),!e&&x(n)||(n=function(t,n){if(e&&(n=e.call(this,t,n)),!$(n))return n}),r[1]=n,C.apply(N,r)}}}),L[k][q]||e(5)(L[k],q,L[k].valueOf),l(L,"Symbol"),l(Math,"Math",!0),l(r.JSON,"JSON",!0)},function(t,n,e){e(25)("asyncIterator")},function(t,n,e){e(25)("observable")},function(t,n,e){e(62);for(var r=e(1),o=e(5),i=e(17),u=e(7)("toStringTag"),f=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],c=0;c<5;c++){var a=f[c],s=r[a],l=s&&s.prototype;l&&!l[u]&&o(l,u,a),i[a]=i.Array}},function(t,n){"use strict";var e={versions:function(){var t=window.navigator.userAgent;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&t.indexOf("KHTML")==-1,mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1||t.indexOf("Mac")>-1,iPad:t.indexOf("iPad")>-1,webApp:t.indexOf("Safari")==-1,weixin:t.indexOf("MicroMessenger")==-1}}()};t.exports=e},function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var o=e(40),i=r(o),u=function(){function t(t,n,e){return n||e?String.fromCharCode(n||e):o[t]||t}function n(t){return l[t]}var e=/&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g,r=/['<> "&]/g,o={"&quot;":'"',"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" "},f=/\u00a0/g,c=/<br\s*\/?>/gi,a=/\r?\n/g,s=/\s/g,l={};for(var p in o)l[o[p]]=p;return o["&apos;"]="'",l["'"]="&#39;",{encode:function(t){return t?(""+t).replace(r,n).replace(a,"<br/>").replace(s,"&nbsp;"):""},decode:function(n){return n?(""+n).replace(c,"\n").replace(e,t).replace(f," "):""},encodeBase16:function(t){if(!t)return t;t+="";for(var n=[],e=0,r=t.length;r>e;e++)n.push(t.charCodeAt(e).toString(16).toUpperCase());return n.join("")},encodeBase16forJSON:function(t){if(!t)return t;t=t.replace(/[\u4E00-\u9FBF]/gi,function(t){return escape(t).replace("%u","\\u")});for(var n=[],e=0,r=t.length;r>e;e++)n.push(t.charCodeAt(e).toString(16).toUpperCase());return n.join("")},decodeBase16:function(t){if(!t)return t;t+="";for(var n=[],e=0,r=t.length;r>e;e+=2)n.push(String.fromCharCode("0x"+t.slice(e,e+2)));return n.join("")},encodeObject:function(t){if(t instanceof Array)for(var n=0,e=t.length;e>n;n++)t[n]=u.encodeObject(t[n]);else if("object"==("undefined"==typeof t?"undefined":(0,i.default)(t)))for(var r in t)t[r]=u.encodeObject(t[r]);else if("string"==typeof t)return u.encode(t);return t},loadScript:function(t){var n=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(n),n.setAttribute("src",t)},addLoadEvent:function(t){var n=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){n(),t()}}}}();t.exports=u},function(t,n){function e(t,n){t.classList?t.classList.add(n):t.className+=" "+n}t.exports=e},function(t,n){function e(t,n){if(t.classList)t.classList.remove(n);else{var e=new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(e," ")}}t.exports=e},,,function(t,n){"use strict";function e(){var t=document.querySelector("#page-nav");if(t&&!document.querySelector("#page-nav .extend.prev")&&(t.innerHTML='<a class="extend prev disabled" rel="prev">&laquo; Prev</a>'+t.innerHTML),t&&!document.querySelector("#page-nav .extend.next")&&(t.innerHTML=t.innerHTML+'<a class="extend next disabled" rel="next">Next &raquo;</a>'),yiliaConfig&&yiliaConfig.open_in_new){var n=document.querySelectorAll(".article-entry a:not(.article-more-a)");n.forEach(function(t){t.setAttribute("target","_blank")})}var e=document.querySelector("#js-aboutme");e&&0!==e.length&&(e.innerHTML=e.innerText)}t.exports={init:e}},,,,,,,,,function(t,n){function e(t,n){if("string"==typeof n)return t.insertAdjacentHTML("afterend",n);var e=t.nextSibling;return e?t.parentNode.insertBefore(n,e):t.parentNode.appendChild(n)}t.exports=e}])</script><script src="/./main.2d7529.js"></script><script>!function(){var e=function(e){var t=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(t),t.setAttribute("src",e)};e("/slider.885efe.js")}()</script>


    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
      
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'friends')"><a href="javascript:void(0)" q-class="active:friends">友链</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于我</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br/>1、在博客根目录（注意不是yilia根目录）执行以下命令：<br/> npm i hexo-generator-json-content --save<br/><br/>
            2、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: true
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    
    	<section class="tools-section tools-section-friends" q-show="friends">
  		
        <ul class="search-ul">
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接1</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接2</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接3</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接4</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接5</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接6</a>
            </li>
          
        </ul>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">很惭愧&lt;br&gt;&lt;br&gt;只做了一点微小的工作&lt;br&gt;谢谢大家</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>